<html><head><title>The Triton Manual</title></head>

<body>
<h1>ONE BOARD HOME COMPUTER</h1>
<p><b>ETI, Transam and Mike Hughes, who designed the system, present the Triton - a one board computer that includes all the features expected in a machine providing the basis of a really powerful home system.</b></p>

<img src="man_fig1.png">

<h2>INTRODUCTION</h2>

<p>Personal computing to date has been beyond the budget of many, and beyond the capabilities of many more. The dual skills of being able to construct one's own hardware and being able to create one's own meaningful software programs has, until now, limited the use of personal computers in this country.</p>

<p>The development of the TRITON computer now means that anyone can own, construct and use his own personal computer, no matter in which direction his particular skills may lie.</p>

<p>The TRITON Manual is designed in such a way as to remove the cloak of mystery surrounding the various aspects of computing - hardware, firmware and software - by explaining every aspect of the overall system in great detail, giving worked and documented examples of programs, both in machine code and in Basic wherever possible, and a clear and concise description as to exactly what is happening and why.</p>

<p>The TRITON project was conceived from the obvious demand for a single-board computer that was easy for the enthusiast to construct and that actually was "a computer" as opposed to a microprocessor evaluation kit. It was to be capable of being programmed in a high-level language, Basic, as well as machine code, having a full keyboard, graphics capability, output to UK domestic TV set and tape recorder for visual display and storage, and to incorporate as many of the most recent advances in microcircuitry as possible to make it compact, portable and inexpensive.</p>

<p>In conjunction with Electronics Today International and ourselves, Mike Hughes, the designer of the project, has achieved this and more, the overall system being a very versatile and powerful computer with tremendous potential in homes, schools, colleges and industrial control and monitoring as well as business.</p>

<p>We hope that your interest in the TRITON will be well rewarded and that this Manual will help you and other enthusiasts to build, enjoy and learn more about personal computing, computers, how they work and how to use them.</p>

<p>TRANSAM COMPONENTS LTD<br>
12 CHAPEL STREET<br>
LONDON NW1<br>
Tel 01-402 8137</p>

<h2>SPECIFICATION</h2>

<ul>
<li>SINGLE-BOARD CONSTRUCTION</li>
<li>8080A BASED SYSTEM</li>
<li>BOARD HOLDS UP TO 4K ROM</li>
<li>POWERFUL 1K MONITOR IN ROM</li>
<li>POWERFUL 2K TINY BASIC IN ROM</li>
<li>UP TO 3K USER RAM ONBOARD</li>
<li>64 GRAPHICS CHARACTERS</li>
<li>AUDIO (STANDARD TTL) OUTPUTS</li>
<li>COMPLETE POWER SUPPLY</li>
<li>1K VDU RAM ONBOARD</li>
<li>8 LEVELS OF INTERRUPT</li>
<li>TAPE I/O AUTO START STOP</li>
<li>2 MODE VISUAL DISPLAY I/O OR MEMORY MAPPED</li>
<li>FULL ALPHA NUMERICS</li>
<li>UHF OUTPUT TO UK TV SET</li>
<li>FULL 56 STATION KEYBOARD</li>
<li>42 LINE EXPANSION BUSBAR</li>
<li>FULLY BUFFERED OUTPUT LINES FOR UP TO 64K MEMORY +256 I/O PORTS</li>
<li>SPECIALLY DESIGNED CASE WITH ROOM FOR EXPANSION</li>
<li>USES ALL LOW POWER SCHOTTKY TTL</li>
<li>SPEED<ul><li>Master Clock 7.2MHz</li>
<li>Microcycle 1.25uS</li>
<li>Instruction execution 6 to 13.75uS</li>
<li>Tape I/O 300 Baud</li>
<li>Print rate I/O Mode VDU 100 C.P.S.</li>
<li>Display format 64 characters &times; 16 lines</li></ul></li>
<li>FIRMWARE RESIDENT IN ROM</li>
</ul>

<p><b>1K MONITOR</b> &mdash; 2 front panel interrupts allowing "Screen Clear/Cursor Reset" and reinitialisation without clearing memory. User machine code programming, memory check and modifications running of programs in machine code, listing, tape I/O for machine code or basic programs. Tape input with named file search facilities, clear and precise prompts and default statements &mdash; vectored jump to basic.</p>

<p><b>2K BASIC</b> &mdash; provides the following commands and functions ABS IF NEW RETURN STEP FOR INPUT NEXT RND STOP GOSUB LET PRINT RUN TO GOTO LIST REM SIZE VDU ARITHMETIC AND LOGIC OPERATIONS (INTEGER ONLY) DIVIDE MULTIPLY SUBTRACT ADD GREATER THAN LESS THAN EQUAL TO NOT EQUAL TO GREATER THAN OR EQUAL TO LESS THAN OR EQUAL TO</p>

<p>A VERY VERSATILE POWERFUL COMPACT PERSONAL COMPUTER</P>

<h2>DESCRIPTION OF THE SYSTEM</h2>

<p>Constructing a computer can be both challenging and educational. It certainly helps if you understand some of the terms and practicalities already but our aim has been to make TRITON a problem free and relatively easy to build computer.</p>

<p>Whether you are an electronics expert, a software specialist or a newcomer, you MUST know in general terms what the TRITON computer comprises otherwise you will not be able to get the best use from it when it is finally built. This manual is split up into different sections, each of which can be read independently and we suggest that you try the ones which sound most interesting first. You can then return to the constructional details.</p>

<p>The system itself is shown in Illustration A in block diagram form. For clarity, some of the single wire interconnections have been left out but nothing of significance has been omitted. The choice of this central processing unit was based on several major considerations.</p>

<p>It has a very easily understood instruction set which is remarkably versatile for working at machine code level. There is also a great variety of software freely available to use with it. Last but not least, it is one of the cheapest CPUs available today.</p>

<p>The 8080 sequences through a list of instructions held in memory in 8 bit bytes and on receipt of each instruction, will carry out an operation which ranges from getting another byte of data from somewhere else in memory to carrying out simple logical or arithmetical operations on that data. It is not within the scope of this Manual to cover the inner workings of the MPU itself or for that matter, to explain every operation that the 8080 can offer. You
can learn these when you have built the instrument and a further reading list is included in the reference section at the end of the Manual.</p>

<p>As it operates sequentially, the CPU needs a clock. In this case the master frequency is 7.20 MHz which is divided down to clock the CPU every 1.25 uS. This time is the duration of a microcycle and it takes from 4 to 11 microcycles for the CPU to complete an instruction.</p>

<p>The CPU has quite a large number of lines leading to it. The most significant are those carrying data to and from it. These number eight and are in the form of a bi-directional busbar (ie. can carry data to or from the CPU). To cut down on the number of wires coming from the CPU the data busbar serves a secondary purpose. It carries what is called 'STATUS' information at a certain point in time within an instruction cycle.</p>

<img src="man_fig2.png">

<p>This Status information is in the form of an 8 bit byte, decoded by a device called a System Controller. When decoded, the Status byte feeds one of 5 lines with a logical '0' which tells the whole of the computer what sort of instruction the CPU is executing during that cycle. These lines are designated <SPAN STYLE="text-decoration:overline">INTA</SPAN> (meaning that the computer has just been interrupted by an external 'Interrupt Request'), <SPAN STYLE="text-decoration:overline">MEMR</SPAN> (reading data from a memory location), <SPAN STYLE="text-decoration:overline">MEMW</SPAN> (writing - or storing - data into an internal memory location), <SPAN STYLE="text-decoration:overline">I/OR</SPAN> (reading data from an external source - such as a keyboard or a tape system) and <SPAN STYLE="text-decoration:overline">I/OW</SPAN> (writing or outputting data to an external destination such as a VDU or a tape system). The computer can only do one thing at a time so only one status line on the control bus will be active with '0' at any point in time.</p>

<p>Of equal importance to the data bus are the 16 lines which carry a 2 byte WORD which is used to ADDRESS a specific byte of memory. These form the uni-directional ADDRESS BUSBAR. Using 16 binary lines, one can therefore address up to 65,536 (decimal) memory locations. This figure is used to describe the maximum capacity of a complete system and is abbreviated as '64k'. A machine having this maximum memory capacity would be too large for domestic applications but it might be necessary to go to this extent for business or scientific purposes.</p>

<p>For this reason we have limited the capacity of our single-board computer to 8k of memory but the address busbar (in common with the data and control buses) are buffered and can be fed to the outside world through a multiway connector, thus allowing easy expansion to maximum capacity with add on boards.</p>

<p>The address bus also serves a multiplicity of roles, depending on whether the instruction cycle is a memory addressing or an I/O addressing cycle. As already stated, all sixteen lines are used to address memory locations, but during an I/O read or write cycle the CPU is limited to providing address data on the eight least significant address lines. These eight lines are decoded at the correct point in time to activate any one of 256 possible external devices through what are called PORTS.</p>

<p>It should now be clear that the address bus works in conjunction with the status lines of the control bus to let all the memory locations and I/O ports know what is going on.</p>

<p>Before moving on from the heart of the system, it is worth mentioning some of the single lines depicted on the illustration. When the computer is initially switched on, it is necessary to give it the right instruction to start with so that it can sequence on from there to complete the program in a sane manner. For this reason it is usual to have the first instruction at address location zero. This is logical and it is easy to make sure that the CPU looks at this location first by resetting the program counter to 0000H (this means zero written as a four digit hexadecimal number). We can reset the program counter of the CPU by depressing a push button or as built into this machine, POWER ON RESET.</p>

<p>The line marked HOLD may be used for very special applications involving DMA (Direct Memory Access). Basically, this means that by making this line go to logic '1' it is possible to isolate the internal CPU from all three busbars (using the tristate facility of the buffers) and allow an external device to do what it will with the internal memory. We have strapped this line to '0' with a removable link so the facility is there if required. RDYIN is used if any memory or peripheral is incapable of responding as fast as the computer desires. The external device can make this line go to '0' for any period of time (usually set by a monostable) and when this happens the computer goes into a WAIT state and simply stops operating as long as this line is low. When the RDYIN signal is removed, it carries on as if nothing had happened.</p>

<p>The signal WAIT is issued during this time and the WAIT line can be seen designated as one of the unbuffered outputs. The RDYIN line provides a very useful option for those who do not wish to use it for its primary purpose. By connecting it via a push button switch to ground, the computer can be halted in the middle of any operation. This is particularly useful for stopping a BASIC LIST operation for cursory inspection. Facility for bringing this out to a push button is not made on the board but it is a simple matter to pick up the right point on the top side and take it via a single wire to the front panel - see the circuit diagram in this section.</p>

<p>The RESET output goes high mementarily when the reset button is pressed and can be used to carry out a synchronous reset on external equipment. The HDLA output indicates that the computer has gone into a HOLD (or DMA) state - if anyone takes the HOLD line high. The INTE line (Interrupt Enabled) indicates that the computer may be interrupted and the DBIN line indicates which way the computer expects data to be flowing on the bi-directional data bus. It goes high when CPU is expecting data to flow INTO it.</p>

<p>We are using the <SPAN STYLE="text-decoration:overline">STSTRB</SPAN> (STATUS STROBE) signal for a very special purpose - to synchronise the memory mapping of the VDU - more is said about this in the relevant section.</p>

<p>As already inplied, the 8080 will allow itself to be interrupted in mid program provided that the program sets the Interrupt Enable flag. This provides the possibility of breaking into a program that is running to do something totally different. There is facility for 8 possible interrupts but only 7 can really be used on this machine (Interrupt 0 is redundant as it duplicates RESET).</p>

<p>An interrupt is entered into the machine on a single interrupt request line. Of the seven usable lines we are using, two within the machine to do a clearing operation on the VDU screen and to do a re-initialisation without clearing all the memory (which would otherwise happen if the reset button was pressed). There are five remaining lines, one of which is brought out to a spare push button on the front panel and the rest piped down the multiway socket along with the busbars. The interrupt request lines have to be encoded and formatted into an 8 bit date byte. When this is done the interrupt encoder tells the CPU with the INT signal that an interrupt has been received. When the CPU is ready to be interrupted, it issues an 'Interrupt Acknowledge signal <SPAN STYLE="text-decoration:overline">INTA</SPAN> which is used to place the encoded byte onto the data bus. This byte enters the CPU and directs the computer to operate the desired subroutine. At the end of the routine the computer reverts to the main program continuing at the point at which it was interrupted.</p>

<p>The memory of TRITON is split into three types on the main board. There are locations for up to 4k of Read Only Memory (ROM) which is split between four 2708 Erasable ROMs. These occupy address locations 0000H to 0FFFH. The standard TRITON uses the first 1k to hold Monitor and Utility routines necessary to initialise the machine and re-vector interrupts. The next 2k holds a BASIC INTERPRETER and the fourth 1k block is left spare for future expansion or user designation.</p>

<p>There is 1k of Random Access Memory dedicated to the VDU. This starts immediately above the ROM area starting at 1000H. Normally this RAM is addressed in synchronism with the VDU line scan by the VDU control circuitry but the CPU can take over addressing under program control (in effect interrupting the VDU). This way the VDU can be built into the memory architecture of the main computer allowing quite spectacular animated visual displays. The VDU RAM can be written into only by the computer.</p>

<p>The rest of the memory is made up of RAM which is both read and write. This area is used to hold the stacks and tables of the MONITOR and BASIC INTERPRETER (512 bytes) and the main work area starts at 1600H for a further 2&frac12;k ending at 1FFFH. This represents the full capacity of the on board memory. There is no reason however, why further read write memory should not be added externally starting from location 2000H. 

<p>The ROM and VDU RAM areas are blocked into units of 1k - to fall into line with the types of integrated circuits used. However the stack and work area RAMs are laid out in blocks of 256 bytes. The reason for the smaller blocks for the latter is to allow the user to choose to what extent he wishes to build up the on board memory. Those on a limited budget can extend the memory in fairly gentle stages, although to achieve any realistic use from the Basic Interpreter, it is essential to have at least five of these blocks.</p>

<p>The high order bits of the address busbar are used to decode which block is being addressed - this is done by the Chip Select decoder. Four lines can be seen going from this to the ROMs, the single line to the VDU 'Memory Mapping Changeover' logic and the remaining twelve lines to the Read Write blocks. Note that the ROM chip selects are gated with the <SPAN STYLE="text-decoration:overline">MEMR</SPAN> signal from the Control Bus whereas this control signal and <SPAN STYLE="text-decoration:overline">MEMW</SPAN> go straight to the RAM chips. This is because the 2111 Random Access Memory ICs used have internal chip select gating and output enables.</p>

<p>With the exception of the VDU which is 'hybrid' the rest of the system is made up from a variety of I/O stages. The most important of the latter is the Keyboard Input. The keyboard data and strobe lines are fed onto the data busbar via tri-state buffers which form the keyboard input port. Only when the computer's software addresses this port (by decoding the least significant 8 bits of the address bus) through the Port Select logic and issues a <SPAN STYLE="text-decoration:overline">I/OR</SPAN> control signal will data from the keyboard be placed on the data busbar. Working in the opposite direction, the Output Port driving a bank of eight on board LEDs is a set of eight latches which catch and hold whatever data is on the busbar when they receive a coincident pair of signals from the port selector and the <SPAN STYLE="text-decoration:overline">I/OW</SPAN> line of the control bus. These onboard LEDs do help to make the TRITON system more versatile and can be used for test purposes or in specialised development applications. The LEDs themselves could be discarded and the eight lines made available as a spare general purpose output port.</p>

<p>By making use of two redundant latches on the board it was possible to provide two spare output lines on one port and a spare line on the port which also feeds the tape recorder power control relay.</p>

<p>The UART (Universal Asynchronous Receiver/Transmitter) is the device which converts the 8 bit wide parallel data on the busbar to a specially formatted serial stream to feed the tape recorder modulator. It also carries out the complementary function of converting a received serial stream into parallel data bytes. The device operates as if it were two input ports and one output port. One of each sort of port would be obvious for a device which receives and transmits but the requirement for a second input port may not be so obvious. Because the device operates asynchronously from the main computer (it has its own clock operating a 300 baud) it is necessary to make the computer wait from time to time to allow the slower operating UART to complete a transmission cycle. This is indicated by the UART activating a flag which is regularly monitored by the second input port.</p>

<p>The VDU portion of the computer is based on the Thomson-CSF Control chip and operates in a unique manner for this integrated circuit. Not only is it possible to output to the VDU through an output port (in a similar manner to using a teletype) but the computer may also be used to inject data directly in the VDU's memory at extremely high speeds. This is most dramatically illustrated by programs written in low level Assembler when a character can be placed onto the screen in under 30 microseconds. A complete screen full of characters will appear as if the characters had all been outputted simultaneously. When used in conjunction with the special VDU function of the Basic interpreter the speed is greatly reduced but in many instances is faster than the I/O mode with the advantage that characters can be placed anywhere on the screen without having to manipulate the cursor.</p>

<p>A further extension is the way the control chip is used to handle Graphics. Instead of the usual 6 bit wide RAM, 7 bits are used in this VDU application to enable the use of the complete set of ASCII codes. 64 extra character codes are therefore available by using those normally associated with lower case 'alpha' characters and all the control codes. Within the overall context of the computer, some of the control codes serve dual purposes and care has been taken in programming the VDU control ROM to inhibit printing a graphic when a control code is used for genuine control purposes.</p>

<p>The graphic select logic looks at the two most significant bits of the ASCII code and via an EXCLUSIVE OR function determines whether or not the symbol is graphic or alpha-numeric and then proceeds to select the standard alpha-numeric ROM or the specially programmed graphics ROM. There is a great deal of extra logic associates with this operation as well as the Memory Map/IO changeover which is dealt with in the section describing the circuit in detail.</p>

<p>For simplicity and reliability, the TRITON uses an ASTEC UHF modulator as a pre-assembled module. This operates on channel 36 with British modulation standards. For the benefit of those overseas we should mention that the television line and field standards used in this VDU are 50 Hz field rate with random interlace and 312&frac12; lines per field (ie. 625 lines per randomly interlaced frame). The line and field rates are set by the crystal-controlled Thomson-CSF chip.<p>

<h2>CONSTRUCTION</h2>

<p>As the TRITON has been specially designed to work on a single printed circuit board, its construction is relatively easy.</p>

<p>Firstly, it is essential to use a top quality double-sided plated through board for the project. This, together with the complete kit of approved parts for the computer, is supplied exclusively by Transam Components Ltd (who retain full copyright). Unlike many other types of project, the PCB is likely to be the most expensive single item you have to invest in, but it is this component which brings the whole project into scope for the average constructor with no significant theoretical knowledge. You should notice the high quality surface of this board, due to the through hole plating process. Avoid finger contact and certainly keep it free from grease.</p>

<p>There are a large number of plated through holes, (approx. 2,500) and some of these are located beneath components. It would be wise to check the integrity of the through hole plating BEFORE any construction is started. It will probably be sufficient to check point to point with a continuity meter that the power address and data busbars are continuous throughout the board. This can be done by referring to the pin numbers of ICs on the schematic drawings and then picking these up on the topside illustration. An hour or two spent on this exercise is an invaluable insurance that the board has not been damaged in transit. Ideally, you should check the busbar integrity on the UNDERSIDE of the board as it is this side that you will be soldering.</p>

<p>The board has been designed to keep all the most intricate wiring on the top side - in particular the connections that run between IC pins. These are the most vulnerable to a heavy hand on the soldering iron, but this is not to say that any carelessness can be afforded underneath. Use the smallest soldering iron you have available - the bit must certainly be no greater than 3/32" diameter. As stated, ALL soldering operations should be carried out on the underside of the board - the through hole plating will route all necessary connections to the topside.</p>

<img src="man_fig3.png">

<p>Wherever possible, try to reinforce the through hole plating by allowing molten solder to creep through the hole by capilliary action. To do this, hold the soldering iron in place long enough for the heat to flow through the hole and take the solder with it. A couple of seconds longer then your usual soldering time should suffice. You will notice that on the underside of the board there are hundreds of IC pin lands that do not appear to be connected to anything. These lands must be soldered in ALL positions because nearly all of them go somewhere on the top side.</p>

<p>Take your time with the soldering - even at a slow pace you can complete this project in a couple of evenings - because it is very easy to miss a connection or produce a dry joint. We recommend that you insert one component at a time and solder it in completely before moving on to the next - a visual check of each joint is essential and if you have any doubt, check with a magnifying glass. A few seconds taken up doing this can save hours trying to find a single missed connection. Insert IC sockets in descending order of size - ie. 40 pin, then 28 pin, etc, by which way you will avoid soldering the wrong socket in the wrong hole.</p>

<p>All the holes on the board have been pre-drilled to the correct diameters, but in the event of your having a device which will not quite go through the hole, do NOT under any circumstances attempt to drill out to size - you will ruin the through hole plating. The ONLY holes you are permitted to drill out are the fixing holes for the board and the mounting holes for the extender socket. If you have a stubborn component, for example the modulator, try scraping down the diameter of its lead with a sharp knife or use a needle file to reduce its dimensions slightly.</p>

<p>You MUST use sockets for all the integrated circuits as it is virtually impossible to remove ICs from a double-sided THP board. Transam Components Ltd will not replace components or be able to test your kit if the above instructions are not followed. You should, however, find that all the specified components slide into place with no trouble whatsoever.</p>

<p>Start construction by soldering in all the DIL sockets while the board is flat - it makes life much easier - and then insert all resistors and diodes. In many cases you will find that topside connections run underneath resistors so you should take care to see that there is no possibility of the bare resistor wire shorting onto these tracks. Where you feel this to be a hazard, use a piece of sleeving over the wire.</p>

<p>Next, insert the nine board pins which connect to the transformer and IC1 (the off-board voltage regulator). If these protrude underneath the board by more than 1/16" crop them off short to avoid them shorting to the cabinet when the final board is mounted in its case. Proceed to solder in the in line strip sockets and the extender socket. When the latter is firmly soldered, CAREFULLY drill out the board mounting holes with a drill, using the connector's holes as a guide, and then bolt it firmly into place.</p>

<p>Insert the three transistors for the tape I/O. These have self-locking lugs on their legs and some careful manoeuvring is required to get them through the board. Move on to the capacitors and LEDs.</p>

<p>Leave the three large smoothing capacitors until last and take care to insert the LEDs the right way round - you will have to look very carefully at the solid tantalum capacitors to find their polarity. Then insert and solder in the three pre-set potentiometers.</p>

<p>Before progressing further, check the polarity of all the diodes and electrolytic capacitors you have inserted. It is often difficult to see the marking on 1N4148 devices so if in any doubt, use a test meter on them. Also make absolutely sure that you have put the zener diode in its correct position.</p>

<p>You can now insert and solder in the three crystals, making sure you have them correctly positioned. The crystals have their frequencies stamped on them (usually in kilohertz). Ideally, it is preferable to use sockets for the crystals, but as space is at a premium on the board, do be careful not to overheat them. This is the only instance where you are advised to use the minimum amount of time with the soldering iron and not to worry about capillary action.</p>

<p>Continue with construction by putting in the modulator and the two onboard regulators. Make sure you have the right regulator in the right position. One is for positive regulation, the other for negative and you can check their type numbers against the parts list and their designations on the board. Also ensure that you insert them the right way round - the metal fin should be on the face of them furthest away from the main smoothing capacitors.</p>

<p>Temporarily mount IC1 on its heatsink and run flying leads to the three pins allocated to it. Be very careful that you observe the correct sense of its two pins which are offset from the lateral centre line of the package. Hold your device against the layout drawing and turn it so that the pins are nearer the top than the bottom and you will then have the same sense as the drawing.</p>

<p>Before inserting any integrated circuits, give the power supply a dry run. Connect up the remaining six board pins to their corresponding terminals of the transformer and apply power. Use a voltmeter to ensure that you have the correct voltage rails present. You should get +5V and +12V at the output pins of ICs 1 and 2 respectively, and -12V at the output of IC3. You should read -5V at the junction between R1 and the zener diode. If all is well here, systematically check that you have the correct voltages at the sockets of EVERY integrated circuit. Use the schematic diagrams to help you identify the pin numbers. Finally, check that you have inserted the single wire link to the right of the extender socket.</p>

<p>Insert all the integrated circuits making ABSOLUTELY SURE that you have them orientated correctly and that they are in the correct locations. Again use a magnifying glass to read their type numbers as some of them look similar at a quick glance. Use the dot on the UART to locate pin 1 as the notch can be misleading. Note that the orientation of ICs varies a lot on the board and you must check each one individually. Insert the 2708 EROM chip that is marked MONITOR V4.1 into the socket for IC21, the one marked BASIC L4.1 'A' into the socket for IC22 and BASIC L4.1 'B' into IC23. The standard kit includes eight TMS 2111-2 devices (some may have different manufacturer's marks owing to availability from the standard suppliers). These should be inserted into IC locations 25 to 32 inclusive. The only gaps you should have on the board are for IC24 and ICs 33 to 48.</p>

<p>Do not install the keyboard at the moment but simply make up a coaxial lead linking the modulator to the aerial socket of a standard 625 line television set. Switch on the TV and allow it time to warm up, check that a rastor is just visible and tune it to approximately channel 36.</p>

<p>Set the three onboard potentiometers to their midway positions and apply power to the computer. You should see some change on the television screen even though you may not be spot on tune. Try adjusting the tuning over the whole range until a strong signal is locked in. You should now see the welcome message:<p>

<pre>TRITON READY
FUNCTION? P G I O L W T</pre>

<p>Once you can read this signal, you can rest assured that your computer is working. Switch the computer off, wait a few seconds and switch it on again. For a fraction of second you will see some garble on the screen which will rapidly clear and the previous message will be repeated.</p>

<p>If you do not get this reaction you have made a mistake somewhere down the line which is almost certainly going to be one of the following:</p>

<ul><li>Dry joints</li>
<li>Missed connections</li>
<li>Components in the wrong place</li>
<li>Solder splashes across tracks</li>
<li>EROMS plugged into the wrong sockets</li>
<li>RAMS plugged into the wrong locations</li>
<li>Faulty components</li>
<li>Faulty PCB</li></ul>

<p>The last two possibilities are most unlikely - particularly the latter, if you carried out the recommended tests. Faulty components are a possibility if you use any from a doubtful source or if you try to use standard TTL instead of the low power devices specified. Avoid this problem altogether by buying best quality devices exactly as specified - they are much cheaper in the long run. If you purchased your components from Transam Components Ltd and can verify that you have checked all the other possibilities of failure, you should immediately contact Transam who will be operating a 'get it going' service for all customers. This will not apply to boards which are returned with careless soldering, soldered-in ICs or non-specified components used as substitutes.</p>

<p>We guarantee that the circuit board is correct and that the design works. Both the board and the resident firmware have been tried and tested over several months and, apart from soldering mistakes on the part of the constructor, no other faults were experienced during the period.</p>

<p>Presuming that all has gone well, you now have a nearly finished computer. Switch off and make up an umbilical cord of wires to go from the keyboard socket on the board to the keyboard and associated push switches. Use colour-coded wire and ensure that you make no mistake when connecting the relevant leads to the keyboard Cinch connector. It is double-sided and you must make sure to hold it with the correct orientation or you may have disastrous consequences with the power lines. Different types of keyboards have different connections - our drawing refers to the George Risk Model 756. We refer you also to the connection details supplied with the keyboard. The only comment we should make is that the specified keyboard, and some others, give you an option for bit 6 of the data. One option gives upper case characters (capitals) only, while the other gives both upper and lower case. This application needs the latter. The strobe is the static strobe which goes to '1' as long as a key is depressed.</p>

<p>The specified keyboard does not have any built-in direct function keys so these have to be provided by separate push buttons. These must be mounted on the front panel and are used to provide RESET, INT1 (Clear Screen), INT2 (Reset without clearing memory), and TAPE MANUAL OVERRIDE - ganged with PAUSE (see descriptions elsewhere). The first three push switches all have a common ground and are 'push to make' with a spring return. Use the Common lead and the respective signal leads to go to each of these switches. The fourth switch must be double pole 'push to make - push to break'. One pair of contacts should take the special 'PAUSE' line to ground when it is on. This line does not exist in the umbilical cord coming from the board socket but must be soldered to the end of R3 going to pin 3 of IC4. The other pair of contacts is connected across the tape power control pins of the respective DIN socket.</p>

<p>You can make up all the above on flying leads to test the unit fully before putting it into its cabinet. Power up again and get the initialisation message. Try pressing any key on the keyboard EXCEPT P G I O L W or T and the computer should respond by saying INVALID. Press CONTROL C and the screen should clear and re-initialise. Press RESET. When the button is released the same should happen. Try INT2 and the machine should, again, re-initialise. When you try INT1 the screen should clear without the message appearing. To get something back on the screen, press any keyboard key except those in the 'key character' message (P G I O L W T). You should once more get INVALID. Depress CONTROL C once more and your computer is re-initialised and ready for test.</p>

<p>We are assuming at this stage that you do not know anything about programming, so simply follow the instructions and check that you get what is described.<p>

<p>Depress P on the keyboard (there is no need to press shift because the Monitor program automatically gives you upper case). You will get: 

<pre>P
PROG START=</pre>

<p>(The computer is asking you to tell it the address of the part of memory you wish to inspect).</p>

<p>Type in 0000 followed by carriage return. The display will now show:</p>

<pre>P
PROG START= 0000
0000 31</pre>

<p>(31 is the data in location 0000)</p>

<p>Depress the carriage return repeatedly and you will get the following as you step through the Monitor program instructions:</p>

<pre>P
PROG START= 0000
0000 31
0001 80
0002 14
0003 FB
etc...</pre>

<p>Re-initialise with CONTROL C and then type L. The computer will again ask you for a start address but this time will list out the contents of 15 adjacent locations starting from that address. We can use this to test that the memory is there and working in the RAM area.</p>

<p>Answer the computer with the address 1600 and a carriage return. If you make a mistake before you press CR you can backspace with CONTROL H and change an entry, but you must then type through the rest of the line on the screen. The computer will list the contents against the memory addresses and then stop and ask for 'MORE?'. If all is well you should see 00 in all locations. To continue, type Y and keep doing this, checking all the locations up to the highest order RAM on the board. Above that address the computer will read FF which indicates that there is no memory there. If you see any data above address 15FF (that is, anything other than 00 or FF) you can be sure you have a bad connection to the RAM IC which contains the data in question. This test only holds true immediately after first initialisation and cannot be used if you have attempted to write programs.</p>

<p>To get out of LIST, type any character other than Y and the computer will re-initialise. Carry out this or any of the other reset procedures already described and procede to check the G function. This is to facilitate running a machine code program. The computer will acknowledge:</p>

<pre>G
RUN
PROG START=</pre>

<p>This means it is ready to run but wants you to tell it from where in memory it should get its first instruction. Give it this information by typing 02B9 followed by CR. You will actually be running a re-initialisation program in the Monitor which should just acknowledge with:</p>

<pre>FUNCTION? P G I O L W T</pre>

<p>You are now back where you started so you can try typing W which turns the computer into nothing more than a video display typewriter. You can type away to your heart's content testing out all the alpha-numeric and graphics characters, using the keys in unshifted, shifted and control mode. Do this while inspecting the coding tables shown in the section describing the VDU and get used to the cursor move commands. Type a full line of characters and adjust VR1 for best line length. To get out of this mode of operation use CONTROL C or any of the other methods of resetting. It will be fun for you to see BASIC L4.1 in action so depress T. The computer acknowledges with:</p>

<pre>T
BASIC L4.1
OK</pre>

<p>Type in NEW followed by CR to ensure the memory is cleared and the computer re-acknowledges with the BASIC header.</p>

<p>Very carefully type in the following message line by line with a CR at the end of each line. Remember you can correct by backspacing with CONTROL H before you hit CR.</p>

<pre>10 FOR A=1 TO 10
20 PRINT 'YOU ARE MY MASTER'
30 NEXT A
RUN</pre>

<p>You should not re-type the 'greater than' prompt signs - the computer is prompting YOU with these. When you press CR after typing RUN we hope you will be surprised - you have just written your first program.</p>

<p>You can now be confident that your computer is working correctly and it only remains to test and adjust the Tape I/O circuits. This must be done in stages.</p>

<p>First check the Tape Output software. Connect an audio monitor (simple amplifier or crystal earpiece) between the 'Tape Out' socket on the board and ground. You should hear a continuous tone. Call up BASIC by typing T and enter the above program again. Once you have done this, get back to the Monitor without erasing your BASIC program (use CONTROL C). Now press O to call up the Tape Output routine.</p>

<p>The computer will ask you for a TAPE HEADER which can be anything you like written in alpha-numerics. Preferably do not use a title longer than 20 characters as you might run out of input buffer space. We suggest you type in SLAVE ROUTINE. Follow this with CR while listening to the tone on the ear piece. Nothing will happen on the VDU but after a pause of between 5 and 6 seconds (this could be longer if you are using a master clock crystal lower than the 7.20 MHz as specified) you will hear about 1 second of regular high speed pulses followed by a few seconds of what can best be described as 'burble' (this is your program going out). The burble will stop and you will hear just the continuous tone you heard at the beginning. After a further 5 or 6 seconds, the VDU will confirm that the file has finished by displaying END followed by the re-initialisation heading.</p>

<p>Repeat this exercise but this time connect a continuity meter across the tape power control sockets on the board. The manual override switch must be open circuit. While you type in the tape header code the meter should show that the relay is open circuit, but as soon as you depress the CR to start the operation, the relay closes and stays closed until the VDU types END. It is obvious that the 5 or 6 second delay at each end of the routine is to allow a portion of blank tape to go by to reduce the chance of overlapping files or missing the start of the active tape at the beginning of a new cassette.</p>

<p>You must now set the Baud rate for your system. The simplest way is to use a frequency meter connected to pin 3 of IC81. Adjust VR2 until the meter reads exactly 4,800 Hz. A better way, and probably more viable for most constructors, is to use a standard test tape. This is available from Transam. It is better because different tape recorders might operate at different speeds which would influence the play-back baud rate of your system. This does not matter if you are only recording and playing back your own programs, but if you wish to use those from other sources, your OVERALL SYSTEM must operate at 300 baud. Using a standard test tape calibrates your overall system to 300 baud.</p>

<p>To carry out this test properly, you must have a master clock crystal having a frequency greater than 4.5 MHz, otherwise the VDU may not print out as fast as the data is coming in from the tape. You must also enter and run a special machine code program to facilitate the test. (How the program operates is explained in the section on the Monitor). The machine code program accepts any data on the tape and displays it, verbatim, on the VDU. If garble is received and decoded, garble will be printed. The test tape contains the alphabet followed by CR and Line Feed repeated many times over a period of a few minutes. All you have to do when the program is running, is set VR3 to its midway position and adjust VR2 until vou get the alphabet reliably repeated on the screen. If, at the best setting of VR2, you still get occasional garble, try altering VR3 for sensitivity. You should of course, be using the phono output from your tape recorder, but if you do not have this, use the extension speaker socket with the volume set about 20% up from minimum.</p>

<p>Now carry out the following instructions EXACTLY.</p>

<p>Initialise the computer with RESET, type in P and enter the start address for the program as 1600. For zero always use 0 and not O. Press CR and location 1600 will be shown to contain 20. Now use the memory change facility to start writing your program. Simply type in the following list of hexadecimal instructions - each pair of digits should be followed by CR. You will end up with a column showing address locations to the right of which is a column showing what WAS in that location (it should have been 00 in all cases) and to the right of that the new data you have just typed in. When you have typed in the complete list of instructions, use CONTROL C to re-initialise, then type L, and list from location 1600 (as previously described). Check that the codes in each location correspond EXACTLY with those in the published program. Use CONTROL C to re-initialise and then type G. Enter 1600 without pressing CR at this stage. Make sure your tape recorder is properly connected to the board and switch on the recorder in PLAY mode.</p>

<p>Press CR and procede to adjust VR2 as previously described. You should see:</p>

<pre>ABCDEFGHIJKLMNOPQRSTUVWXYZ
ABCDEFGHIJKLMNOPQRSTUVWXYZ
ABCDEFGHIJKLMNOP etc..</pre>

<p>until the recording ends or you switch off the tape recorder. While this is happening your computer is locked within a program loop and you will NOT be able to get out of this with CONTROL C. You will have to use INT2 to re-initialise.</p>

<p>Here is the program you must type in:</p>

<pre>1600 CD 
1601 27 
1602 03 
1603 CD 
1604 1D 
1605 03 
1606 CD 
1607 13 
1608 00 
1609 C3 
160A 03 
160B 16</pre> 

<p>Your TRITON is now completely set up and ready for use. You have made an extremely powerful computer whose applications are limited only by your own imagination and the development of more sophisticated software - coupled with extender boards to give you extra I/O functions (Floppy Disks, Line Printers, extra Tape Recorders, more Memory, etc). We have plans for further exciting applications and developments. Please contact us or watch our advertisements in the national magazines.</p>

<h2>FINAL ASSEMBLY</h2>

<p>We strongly recommend that you solder in all the sockets where there are spare locations on the board. This will make life much easier for you if ever you wish to increase the on board memory. When you have done this and have completed all the recommended tests you should procede to assemble the printed circuit board into the cabinet.</p>

<p>To make life easy we have arranged for the cabinet to be pre-drilled with all the major holes but you will have to drill out the fixing holes on the printed circuit board to suit the screw diameter. Carry out this operation extremely carefully, making sure that no swarf falls across any of the printed wiring. You should also take steps to avoid flexing the board while drilling - this is best accomplished by placing the whole board flat on an old wooden board using a hand drill from the top side. Make your holes slightly oversize to allow a little tolerance for fitting so that the board will not be under strain when the screws are tightened.</p>

<p>Use long screws inserted from the underside of the cabinet and fix these securely in place with nuts so that they will act as fixing columns. Run a spare nut on to each screw so that it stops about &frac14;" from the inside bottom of the cabinet - these will act as stand off spacers. You can then offer up the board to these pillars to check the fit but do not bolt it into place as yet. Remove the board and stick a sheet of self adhesive plastic film over the inside base of the cabinet where the pcb will be mounted. This will act as an insulator in the event of any untrimmed leads protruding too far beneath the board.</p>

<p>Use four small screws to mount the keyboard pcb to the sunken support bracket making sure that you sandwich a sheet of insulating board between it and the metal work (needless to say - you should remove the conductive foam pad from under the keyboard's integrated circuit). Do not mount the keyboard assembly into the cabinet at this stage.</p>

<p>Mount all the back panel components - DIN sockets, one and two, fuse holder and mains cable grommet and bolt the mains transformer into place. Make sure you place a solder tag under one of the fixing nuts for the transformer for an earth lead. Make up the bank of four push buttons for the front panel and screw into place. Three buttons should be push to make with a spring return and the fourth should be push to make/push to break. The first three are used for RESET, Interrupt 1 (Clear Screen Reset Cursor) and Interrupt 2 (Reset without clearing Memory) while the latter is for tape control manual override. Also mount the separate mains push button switch onto the front panel. Note that we do not supply a push button for Interrupt 3 because we feel that this will be of more use if brought out via one of the sockets on the back panel. 

<p>Get the mains wiring out of the way before proceeding further. The mains live lead should go to the front panel switch via the fuse whereas neutral goes direct to the switch. Do not forget to connect the earth wire to the solder tag under the transformer. We recommend that you use twisted pairs for as many of these mains connections as possible. Secure the mains cable with a clamp.</p>

<p>Mount IC1 and its heatsink to the outside of the back panel. No electrical insulation is necessary but we suggest you cut some short lengths of sleeving to go over the pins of the regulator to prevent accidental short circuits where they enter the cabinet. Place a solder tag under one of the fixing screws. To ensure good heat conduction the fixing screws should be well tightened (conductive grease is not necessary).</p>

<p>Mount the main pcb onto the supporting screws making sure that it is level and well clear of the base of the cabinet - in particular, ensure that the extender socket on the side is clear above the side lip of the cabinet. Use more nuts to fix the board securely in position. Hopefully you will never need to remove it again. Connect the nine power supply board pins to their respective positions on the transformer and IC1 taking particular care with the transformer markings and the orientation of the integrated circuit. DOUBLE CHECK ALL THESE.</p>

<p>Make up a loom of 8 wires to go from the eight pin inline socket on the board (next to RLY1) to the two DIN sockets. We suggest you use one socket to carry the tape in and out audio signals (with their common ground) and the two power control connections. The other socket can be used for the two bits from output Port 6, the spare bit from Port 7 and Interrupt 3 with a common ground. The choice of connections is entirely up to you and might depend on your application or type of tape recorder. It is a good idea to make a record of the connections and stick it on to the back of the cabinet for future reference.</p>

<p>If you have carried out the recommended tests, you will already have made up a loom of wires or have used ribbon cable to go from the sixteen pin inline socket to the keyboard. We cannot overstress the importance of getting the correct orientation of the keyboard's edge connector. The loom at the keyboard end should be split with the power lines, bits 1 to 7 and the strobe going to the keyboard. The reset line and Interrupts 1 and 2 go to the three push to make spring return buttons together with a common ground line taken off the keyboard edge connector.</p>

<p>Take the opportunity to add a pair of wires to this loom going from the tape control override switch to the two respective pins on the tape output DIN socket (loop these onto the two connections which have already been made from the eight pin in line socket). Note that Interrupt 0 is not used and that Interrupt 3 should be taken straight to a spare pin on the I/O DIN socket.</p>

<p>You can now fix the front panel neon taking the supply off the mains switch.</p>

<p>Finally use four screws to bolt the keyboard bracket assembly to the underside of the front panel ensuring that none of the keys foul the cut out. The keyboard edge connector can now be slid into position and we suggest you now use nail varnish to identify the mating ends of this connector as well as the board in line connectors.</p>

<p>It only remains to fix the cabinet cover into position using the self tapping screws, although before doing this it is worth giving the unit a run to check all is well and, if necessary, to carry out a final adjustment to the tape I/O baud rate.</p>

<p>If at a later date you wish to insert extra memory ICs into the spare board sockets, try as far as possible to support the board to prevent too much flexing.</p>

<h1>HOW IT WORKS</h1>

<h2>THE POWER SUPPLY</h2>

<p>It needs no more than a few words to talk about the power supply. It has been kept as simple as possible, utilising three IC regulators to provide the main rail supplies which are +5V at 3A (the computer does not draw all this but there is very little to spare), +12V at &frac12;A and -12V at &frac12;A. A few milliamps are needed by the ROMs and the 8080 at -5V and this catered for by a simple zenar shunt off the -12V rail. You should check when building this stage, that R1 is of &frac12;W rating.</p>

<p>The +12V and negative rails are straightforward. Dissipation by the regulators is quite reasonable to the extent that no heat sinks are necessary. The 470nF capacitors on the outputs of the regulators have been positioned as close to their respective devices as possible to prevent any possibility of parasitic oscillations. Note that the +5V rail has a dozen 47nF capacitors (C3 to C14) shunted across it. These are anti-spiking devices and have been placed in strategic places on the board. To test the prototype under adverse conditions we deliberately left these out and in daily operation over a period to two months, we did not get a single malfunction of the machine. To test the TRITON under even more severe conditions, we installed it within a heavy engineering plant where lathes, drills and grinding wheels were in constant use, as well as equipment operating with thyristor power control systems. At times the stray r.f. coming down the mains obliterated the television picture - but not once did the computer logic fail. Our conjecture that mains input filters on the power input were not necessary was in all cases fully justified.</p>

<p>To avoid excessive dissipation in the main +5V regulator (IC1) - which is still fairly high - we decided on a specially wound mains transformer, hence the rather unusual specification for an 8.25V winding. IC1 needs a large finned heatsink and to dissipate the heat from this we considered it wise to position it on the outside of the cabinet. There are no worries about electrical isolation as the can of the TO-3 package is connected to the chassis and the common rail.</p>

<img src="man_fig4.png">

<h2>THE HEART OF IT</h2>

<p>IC4 is the master clock oscillator which contains divider circuits to provide the two-phase clock (&Phi;1 and &Phi;2) for the 8080. A TTL compatible output of &Phi;2 is available but not used on the main board - this is fed to the extender socket. The chip also contains gating circuits to synchronise the externally generated RDYIN command before feeding this to the CPU. An internal Schmitt Trigger on the reset input line (<SPAN STYLE="text-decoration:overline">RESIN</SPAN>) allows a very simple charge up circuit comprising R2 and C20 to provide power on reset. Manual reset is carried out by momentarily taking <SPAN STYLE="text-decoration:overline">RESIN</SPAN> to 0 volts via a push button. The clock receives a feedback signal (SYNC) from the CPU which is gated with &Phi;1 to give a STATUS STROBE pulse at the precise moment the data busbars are carrying the status byte. The pulse (<SPAN STYLE="text-decoration:overline">STSTB</SPAN>) is fed to the System Control chip (IC6) to latch the status byte and is also used by the VDU to enable Memory Mapping changeover.</p>

<p>We will not attempt to describe the inner workings of the CPU (IC5) in this Manual but simply refer you to the reading list at the end of the book.</p>

<p>Certain outputs (namely HDLA, DBIN, INTE and WAIT) are taken to the extender socket directly from the CPU. These are unbuffered and account should be taken of this if you expand the system. Each line will adequately drive a single TTL load and more if you use low power devices.</p>

<p>IC6 is an 8228N 8080 System Controller which gates out the five main control busbar signals from the status byte at the time of <SPAN STYLE="text-decoration:overline">STSTB</SPAN> and holds these on latches. The chip also comprises a set of bi-directional buffers for the data busbar - the direction of these buffers is controlled by DBIN and their outputs are disabled on the receipt of a DMA request by the HDLA signal. We were not happy that this buffer alone would be capable of supporting a fully extended system so felt it prudent to insert a further buffering stage in the shape of IC9 (74LS245). Like the System Controller, the latter chip is supervised by the HDLA and DBIN signals. Integrity of any DMA request is maintained on the data bus.</p>

<p>ICs 7 and 8 are straightforward uni-directional tri-state buffers which should allow the address busbar to feed a fully extended system. Note that we have inverted A15 prior to putting it on the bus and have therefore been able to economise on chip select decoding circuitry elsewhere in the main board system. This should present no problems to anyone working with extender boards provided that this fact is remembered.</p>

<img src="man_fig5.png">

<p>Let us look at the input lines to this part of the system. The HOLD line going to pin 13 of the 8080 is not used within the main board and is used to carry a DMA request which, via the HDLA signal, puts all the busbar buffers into a high impedence state. This could facilitate a take-over of the complete memory of this system by a peripheral device or, possibly, another computer. This could be very useful to the more professional user who can see an application for TRITON as an intelligent terminal to a larger system. Normally this line should be at logic level '0' so we have hard wired it accordingly with board link. This link MUST be removed, or a switch substituted, if use is made of this line.</p>

<p>The HOLD signal actually proved useful during debugging tests on an early prototype. By removing the link and using sixteen DIL slide switches on the address busbar switching between '1' or '0' it was possible to test every chip select and port select decoder under static conditions with a simple voltmeter. It was also possible to check the contents of the Read Only Memories. This is not a test to be recommended because it is very tedious, but we hope it is reassuring to know that it is possible to check out a large proportion of the board's circuitry in such a simple way.</p>

<p>RDYIN is normally held at level '1'. If taken to '0' it causes the CPU to stop operating. Nothing happens as long as the signal is low and the contents of all internal registers within the CPU are maintained. When the signal returns to '1' the computer carries on operating as if nothing had happened. Normally this would be used to slow the computer down to cater for low speed memories and so is brought out to the extender socket in case it is needed by any devices on extender boards. We suggest that temporary use be made of this signal. By soldering a single wire to the end of R3 going to pin 3 of IC4 (easily found on the top side of the PCB) and by taking this via a push switch to ground, you have a ready made 'PAUSE' control which will enable you to stop the computer in mid program, or for example in the middle of long, high speed print-outs to inspect the screen. With the VDU operating at a rate of 100 lines per minute (equivalent to 100 characters per second) there is no way that one can read and comprehend a high-speed listing without this facility.</p>

<p>The chances are very high that you will not need RDYIN for external systems so the feature could be built in permanently. Note should be made that it is bad practice to have a push switch hard wired to ground on this line if at any time in the future you derive the RDYIN signal from a gate. Press the button and the output stage of the gate will blow. Remember, you must disable the push switch in this mode - this is why we have shown it dotted in and have not built this facility into the PCB in an obvious way. This an extremely valuable facility which is very cheap to include.</p>

<p>You do not even need another push switch because you can use a spare pair of contacts on the Tape Control and Manual Overide. It does not normally matter if you press this button provided that the cassette recorder is switched off with its own control.</p>

<p>IC11 is the Interrupt Encoder which has eight lines going into it. These are normally held high by pull up resistors R4 to R11. The encoded three bit nibble is output in inverted form at pins 6, 7 and 9. If all the inputs are high, all the outputs are high and an '0' is placed on the Enable Output line at pin 15 (the latter is used to generate the INT signal - Interrupt Request - to the CPU). If any single input is pulled to 0 volts, via the push switches or external logic, an equivalent code to describe that line number is output as the Interrupt Data Nibble, and pin 15 goes high telling the CPU that an interrupt has been requested. The computer will carry on operating until it reaches a permissible point in its cycle to service the interrupt. When this point is reached, the CPU outputs an Interrupt Acknowledge signal (<SPAN STYLE="text-decoration:overline">INTA</SPAN>) through the status byte which is decoded and latched by the System Controller. This signal is used to activate the Output Enable of IC12 (an eight bit wide tri-state inverting buffer) which formats the ID nibble to make an eight bit Interrupt Data byte which is then accepted by the CPU as a RESTART instruction. The program counter jumps to one of eight fixed locations in memory - the location is defined by the ID byte - while the STACK preserves all current register data and status information. The computer then operates on the interrupt routine and returns to its main program when it comes to a RET instruction. Interrupts can be nested if the software permits it - this will depend on whether the EI (Enable Interrupt) instruction is used within the interrupting subroutine, because as soon as an interrupt is serviced, the computer will reset the EI flag.</p>

<p>Interrupt 0 should not be used even though it is available on the PCB. It simply duplicates the manual reset operation but would create major problems if used as the Monitor program contains an EI instruction early on in this routine. A very rapid build up of interrupt nests would occur which would fill up the stack in a fraction of a second. If you do not understand this, do not worry - just refrain from connecting the INT0 pin to a push button. INT1 is dedicated by the Monitor to provide a Clear Screen and Reset Cursor facility which can be carried out at any time, even while the VDU is printing data - quite useful for clearing garble from the screen. INT2 is also a dedicated function and is very important. Because the Monitor includes memory test facilities before it causes the computer to be initialised, use of the reset button will clear all memory - this can be very frustrating. To by-pass this problem we are using INT2 as a non-destructive reset which, as far as any running programs are concerned, is just like reset and the system will re-initialise but the memory will not be cleared.</p>

<p>ALWAYS use INT2 for reset unless one of your programs has corrupted the Monitor's stack. Only then should you press manual reset or carry out a Power On Reset by switching the machine off and on.</p>

<p>Finally, a word about clock frequency. You can use any frequency crystal for X1 but the ideal value is 7.20 MHz which should not be exceeded. Lower frequency devices are fine but the computer will operate proportionally slower. If you put in a higher frequency crystal, not only will you run into memory access time problems, but the computer will also be operating at a rate faster than the VDU can handle. The Monitor program has provided the maximum permissible print out rate for a clock frequency of 7.20 MHz.</p>

<h2>PORTS AND CHIPS</h2>

<p>During an INPUT or OUTPUT instruction cycle the CPU will generate the address of the I/O port required on the 8 least significant bits of the address busbar. This has to be decoded to provide a single line signal which will activate the port. It is not sufficient to provide this address on its own because there is no way that the port can tell whether the select signal has come from a genuine port select instruction or whether it is the low order byte of a memory read/write cycle. Futhermore, there are times within the machine cycle when the address busbar can be in a transient or high impedance state which could cause indeterminate address information to be decoded by the port select circuits.</p>

<p>To prevent all these problems and also to differentiate between input and output ports, the decoded port line is gated with either the <SPAN STYLE="text-decoration:overline">I/OR</SPAN> or <SPAN STYLE="text-decoration:overline">I/OW</SPAN> control line. One or other of these lines goes to '0' AFTER the ports select address has been placed on the busbar and terminates BEFORE the address data changes. The pulse, so produced, is of the correct duration to strobe the I/O data on the data bus into or out of the port in question. Take, for example, the control of the Keyboard INPUT port. The port itself is simply an eight wide set of non-inverting tri-state buffers permanently connected to the data bus.</p>

<p>Pins 1 and 19 enable the output of the port when they go to level '0'. Normally these pins are at '1' and held there by the output of IC13b, and keyboard data cannot affect the data bus. IC18b and 15 between them, allow 16 lines to be uniquely decoded from address bits 0 to 7. We use only 8 ports on the main board so part of this facility is redundant, hence not all the outputs from IC15 are used. IC18b is a 2 to 4 line decoder operating here as a 3 input NAND gate. When address 00H is present on the bus, pin 1 of IC15 goes low which points to Port 0 (the Keyboard). This signal is ORED with <SPAN STYLE="text-decoration:overline">I/OR</SPAN> by IC13c, d and b, so when there is coincidence, IC49 receives '0' on pins 1 and 19. Whatever data is coming from the keyboard is transmitted onto the data bus and then accepted by the CPU as genuine input data. The only reason for using three NAND gates to provide the OR function is to use spare capacity in partly used ICs.</p>

<p>While on the subject of the keyboard port, those more experienced in computer techniques might wonder why we use only ONE port for the keyboard instead of having a second one to check the status. The reason is economy - both of components and space utilisation on the PCB.</p>

<img src="man_fig6.png">

<p>We get around this apparent deficiency in the INCH (Keyboard Input) sub-routine of the monitor. More memory is needed for the instructions but this works out cheaper than the extra gates required. Interconnections with the keyboard put the 7 bits of ASCII on bits 1 to 7 and, instead of parity, we are using bit 8 to carry the keyboard strobe.</p>

<p>Output port 3 works in similar fashion. IC15 decodes its address on pin 4 and IC14a ORs it with, in this case, <SPAN STYLE="text-decoration:overline">I/OW</SPAN>. The resultant pulse is used as a clock to the D type latches within IC50. The data is entered into the latches on the rising (trailing) edge of the pulse. Using the trailing edge does not matter here. There is just sufficient current sinking capacity in a 74LS374 (IC50) to drive a small LED direct through a 1k limiting resistor. The brightness is not very high and any variations in LED efficiencies will be more pronounced but quite a usable display is obtained. The byte of data is therefore transferred from the busbar to the latches and displayed in binary fashion on the LEDs. Note that the LEDs are illuminated when an '0' is output. If you want to get a 'non-inverted' display, you will have to use software to complement the data before outputting it to this port.</p>

<p>The VDU, when operating in I/O mode, is situated at PORT 5. This works in much the same way as the LED port but we are using a NOR gate to give a positive going port enable pulse. Bits 1 to 7 carry ASCII data and bit 8, the VDU strobe which is formatted to have the correct timing characteristics by the OUTCH (VDU Output) subroutine of the Monitor program.</p>

<p>A further output port was required to switch the relay of the tape recorder power control (to effect automatic starting and stopping of the tape). Theoretically, a single bit port was all that was required, but as things turned out in the design this would have required a new integrated circuit. Because of this a 74LS75 (IC52) was used, which contains four latches connected as two pairs. This way we were able to provide a tape control signal to the relay at pin 11 (the <SPAN STYLE="text-decoration:overline">Q</SPAN> output of one latch) by using data bit 8 and this left a spare line on that port (bit 7) which can be used by the experimenter as an output line. The port to call for this line is number 7. At the same time the other pair of latches in IC52 are used as OUTPUT PORT 6 which comprises bits 7 and 8 which are also spare.</p> 

<p>As we have moved on to the subject of tape control, take note that there is a push button switch connected across the relay contacts. This is to allow manual override so that the cassette recorder can be rewound etc. under manual control without having to unplug the remote control lead. See the relevant section for more details about the serialiser I/O ports and MODEM for the tape recorder.</p>

<p>The memory of TRITON comprises four 1k blocks of ROM, one 1k block of VDU RAM and twelve 256 byte blocks of Read/Write RAM. The high order addresses are used to decode individual lines which enable each block while low order addresses point to a specific location within the previously decoded block.</p>

<p>IC16 is a 3 to 8 line decoder but we are able to use it to decode, uniquely, eight individual blocks of 1k from the six most significant address lines. This is made possible by using A15 in inverted form and the internal gated select inputs of the 74LS138. The four lowest order selected lines correspond to memory blocks which start at 0000H, 0400H, 0800H and 0C00H respectively, and these hold the MONITOR, BASIC 'A' and BASIC 'B' read only memories. The block starting at 0C00H is a spare block reserved for ROM expansion. The line decoded at pin 11 or IC16 addresses the block of VDU RAM and the remaining three lines are fed to three 2 to 4 line decoders, ICs 17 and 18a, along with address bits A8 and A9.</p>

<p>The last three decoders break down the remaining 1k blocks into 12 blocks, each containing 256 bytes. Each of these 12 lines goes to a specific pair of random access memory integrated circuits that form the main work area of the computer.</p>

<p>Except for the ROMs, gating with <SPAN STYLE="text-decoration:overline">MEMR</SPAN> and <SPAN STYLE="text-decoration:overline">MEMW</SPAN> is carried out within the memories themselves. The 2708 read only memories contain only a chip select input and it is necessary to gate the <SPAN STYLE="text-decoration:overline">MEMR</SPAN> control signal with each of the chip select lines prior to making connection with the appropriate pin. This gating is carried out by the quad 2 input OR gates contained within IC19.</p>

<p>Breaking the main RAM area down into 256 byte blocks made the design of this decoder slightly more complex than it would have been, had 1k blocks been used throughout, but the decision to do this was made on the grounds of economy as already explained.</p>

<h3>Keyboard Connector</h3> 

<p>(As viewed from rear of board)</p>

<img src="man_fig7.png">

<h2>MEMORIES ARE MADE OF THIS</h2>

<p>We have excluded the VDU memory from this description because it is rather special and is covered in detail later.</p>

<p>The illustration has been abbreviated as most of the memory circuitry is a repetition of the same theme. You can clearly see the difference between the ROMs and Read/Write RAMs. There are four of the former - all 2708s - but in the standard machine only three are used immediately. A spare socket is left for the fourth (IC24) so that any expansion firmware can be simply plugged in. The 2708 is an ultra violet erasble ROM which contains 1,024 (decimal) bytes of memory each being 8 bits wide. To access a specific byte within it, you need a 10 bit address and A0 through A9 are used for this purpose. The eight output pins are tri-state which are enabled by an '0' on pin 20 (the chip select input). The respective outputs from each of the ROMS can therefore be commoned together on the data bus. The 'Programming Enable' pin (18) is only used when the devices are being programmed and therefore is left disconnected within the system. We use the block select signal gated with <SPAN STYLE="text-decoration:overline">MEMR</SPAN> to provide the Chip Select strobe for the ROMs (this is described elsewhere).</p>

<p>The Monitor program is located within IC21 which starts at address location 0000H so that the computer will always go through a firmware initialisation routine when switched on. The Power On Reset ensures that the first instruction the CPU reads will be the one located at 0000H. BASIC is located within ICs 22 and 23. Those new to computing should understand that these ICs MUST be placed in their correct respective sockets because there are many JUMP and CALL instructions which link the Monitor to BASIC and vice versa as well as internal jumps. Transam Components Ltd supplies the ROMs ready programmed and as the ICs all have the same type number, they will be supplied with self-adhesive labels identifying which is which. They should be designated MONITOR V4.1 for IC21, BASIC L4.1 'A' for IC22 and BASIC L4.1 'B' for IC23.</p>

<p>Transam will be offering many useful programs in the future to use the space which is left for IC24. Alternatively, readers who have access to EROM programmers can use this space for any of their self-written programs that are worth holding in permanent, non-volatile, form.</p>

<p>The RAM area of memory comprises TMS 2111-2 chips. These each contain 256 locations that are four bits wide. As we need to store eight bit bytes of data, two chips are required for each 256 byte block of memory. The odd number designations IC25 to IC47 correspond to the low order nibble of the byte while the respective even numbers (IC26 to IC48) correspond to the high order. Only eight address lines (A0 through A7) are required to uniquely select a byte within this organisation of a chip pair but we need to specify which pair by means of the Chip Select lines.</p>

<p>The 2111s have internal chip select and Read/Write gating so we are able to drive the <SPAN STYLE="text-decoration:overline">MEMR</SPAN> and <SPAN STYLE="text-decoration:overline">MEMW</SPAN> inputs direct from the control busbar.</p>

<p>ICs 25 and 26 form the first block of RAM which extends from address 1400H to 14FFH. This is used for the stack of the Monitor (set at 1480H) together with sixteen bytes (1400H to 140FH) as a 'SCRATCH' area and an unspecified length going upwards from 1410H as an input buffer. These locations are all specified by the standard Monitor and, of course, could be different if the user were to have a different Monitor. The rest of this block is taken up by part of the table and stack area for BASIC L4.1 which extends right the way through the next block (ICs 27 and 28).</p>

<p>With this information you can see that you could JUST operate the machine under the control of the Monitor only by having ICs 25 and 26 in place, leaving the rest of RAM blank. If you operate under the control of BASIC L4.1 your work area does not start until the third block of RAM (ICs 29 and 30). From hereon upwards you have flexibility in how many RAMs you care to insert (depending cn your budget). Remember they have to be added in pairs and any pair that you add should go into the next highest IC designation - otherwise you will have gaps in your RAM sequence.</p>

<p>Transam supplies eight 2111 10s (1k) in the standard kit of parts which is sufficient to provide all the necessary stack, tables and scratch areas with 512 bytes left as work area for BASIC. With this capacity you will be able to get the machine up and running and enjoy one or two short, experimental educational programs written in BASIC, but for the more exciting and challenging games, you will soon find you need to extend this area. By working in 256 byte blocks, this can be done in easy stages over a period of time.</p>

<p>REMEMBER, when you insert the RAMs, start at the designation for IC25 and work from there upwards as you fill up the RAM capacity of the board. Alternative manufacturer's devices may be used here but it is important to check that they have the same or shorter access time as the TMS 2111-2 which is specified. Note that there is not always uniformity in type numbering between different manufacturers.</p>

<img src="man_fig8.png">

<h2>VDU 4 U2C</h2>

<p>Without doubt this is the most complex discreet IC region of the computer and to understand it fully, you should be well acquainted with the operation of the Thomson-CSF VDU control integrated circuit (IC61). This chip has a built in clock which generates standard TV synchronisation pulses (line and field sync) on pin 26. Random interlace is used and a simplified field sync train is generated as opposed to the full CCIR specification.</p>

<p>The chip, synchronously with this train of pulses, generates addresses for the VDU RAM so that the correct code of the character is selected as the TV raster spot is traversing the respective part of the television screen. An external 'Picture Point Oscillator' (IC55c and d) in conjunction with a divider chain (IC63) sets the horizontal width of a character and steps the address of the control chip by the link from pin 12 (IC63) to pin 9 (IC61). The inverted output of IC63 pin 15 is used to latch the data being addressed by the controller into IC68 (a seven wide latch), latch the picture point pattern generated by the character generator ROM into the serialiser (IC72) and reset the picture point divider chain (IC63) at the end of each character width. Note that the device used as an inverter after pin 15 of IC63 is part of an EXCLUSIVE OR gate. This happens again elsewhere in this circuit to make use of spare functions in partly used ICs.</p>

<p>The picture point width (hence the character width and number of characters per line) is set by the frequency of the oscillator control VR1. This should be set to suit your television screen so that there is a small margin to the right of the 64th character - in this way, no characters are lost.</p>

<p>In the standard application of the Thomson-CSF chip ASCII, data held in the RAM output latches (IC68) is fed to the column address inputs of an RO-3-2513 character generator ROM. Note that our circuit does this but has been extended in this area. Firstly we are using a 7 bit wide RAM to hold the FULL ASCII code - we need this to provide capacity for graphics. The outputs of the latches feed both the standard alpha-numeric character generator (IC69) AND a specially programmed ROM (IC70) which contains picture point data for the 64 graphic symbols. We use the EXCLUSIVE OR function (IC62d) on bits 6 and 7 of the ASCII code to select either the graphics or alpha-numeric ROM. The select signals go through further gating (ICs 67a and d) to ensure that the integrity of the cursor generating pulse (pin 15 of IC61) is not corrupted.</p>

<p>Three further address lines from the VDU controller (pins 11, 12 and 13) address the picture point data ROMS in both ICs 69 and 69. Due to a limitation caused by the internal operation of the Thomson chip the row address code 000 is output for the top row AND the bottom four rows of the character cell. Normally rows 0, 8, 9, 10 and 11 are used to provide inter line gaps for alpha-numeric displays while rows 1 to 7 carry alpha-numeric picture point data. We have had to take this into account when designing the font of graphics symbols - some of which cannot fill the complete character cell rectangle on'the screen. In simple terms, the limitation means that if a graphic demands a bright picture point in row 0, there will have to be bright points on rows 8, 9, 10 and 11 in the same column. Look at the table of graphics characters and you can see how we have adjusted the graphics to suit this restriction.</p>

<p>Further complications caused by this limitation are that a graphic must not appear on the topmost line of the tele-vision screen if that graphic contains picture points in its top row. The Thomson chip requires there to be zeros present here in order to derive field blanking. We could have got round this problem with extra gating but this would have been at the expense of simplicity. The restriction is, however, not much of a problem and in some instances can actually be used as a bonus. For example, by filling the top line of the screen with completely white character cells you will make the whole screen go white above the top line and below the 16th line of the screen, giving a frame to anything printed between the two extremes.</p>

<p>We have got over a similar problem (involving line blanking) by gating the video output with the INI function (pin 26 of IC61) in IC71b. Without this, any graphics symbol having a picture point in its most left-hand column would have caused a 'wrap around' white line that interferes with the d.c. level of the line sync pulse. The only problem that remains in this respect is that you will now get a single 'extra' picture point showing to the right of the 64th character down a line if you use a graphic in the most left-hand position of a line. This does not happen with all graphics - only those that have picture points in their most left-hand column.</p>

<p>The five outputs from the alpha-numeric ROM are wire ORED with five of the eight outputs from the graphics ROM and held high via pull up resistors R22 - 26. They are then fed to the correct positions in the serialiser shift register IC72. Note that the remaining three outputs from the graphics ROM have to be ANDED with a signal defining whether or not the character is a graphic (done by ICs 71a, c and d). This is to ensure that if alpha-numerics are printed there is a correct inter-character gap.</p>

<p>So far we have not explained how the VDU RAM is addressed by the control chip. We will deal with that now.</p>

<p>This is more complex than the standard application because we are allowing the CPU to memory map the VDU RAM to provide fast and possible animated graphics. To do this we have had to make allowance for the CPU to take over addressing control of the VDU RAM. This is done in a very simple way. We have taken all the address lines from IC61 and their equivalents from the computer busbar to a set of data selectors (ICs 64, 65 and 66). If the computer addresses the VDU memory location (any address between 1000H and 13FFH) the block select line (called MAP VDU in this illustration) is activated. This, of course, could happen if ever the address busbar went into a high impedance state (during HOLD, etc) so to prevent any spurious pulses affecting the operation, we gate the VDU block select line with <SPAN STYLE="text-decoration:overline">STSTB</SPAN> which only occurs when valid address information is on the busbar. We do the gating in a D type latch so that during the complete cycle and at all other times, the data selectors hand over address control to IC61.</p>

<p>A similar transfer of responsibility takes place between the normal input data to the VDU (which gets to it via an output port) and the main computer data bus. In this case the data is selected by ICs 59 and 60. These also receive their changeover instruction from the changeover latch IC53. Note that we also have to do a changeover between the internally generated memory write command (pin 17 of IC61) and the computer's <SPAN STYLE="text-decoration:overline">MEMW</SPAN> strobe. This is done within IC60.</p>

<p>It only remains to describe the gates on the VDUs internal data lines and IC54. The former are used to force the ASCII code for 'Space' onto the data lines when pin 13 (IC61) is at '0' in coincidence with a writing pulse to the VDU memory. This is to allow for the very useful internal function provided by the Thomson chip to clear the screen and reset the cursor in one operation.</p>

<p>The VDU controller carries out a number of non writing functions as well as entering and addressing data within its memory. By using some of the ASCII codes as control, it is possible to do such things as move the cursor in steps to any position on the screen, reset the cursor, carry out a line feed or do a carriage return clearing ONLY the unused part of the line. There are also a couple of control codes that we wish the VDU to ignore - 00H and 04H respectively - these are NUL (or no operation) and EOT (end of text) flags. Recognition of all these special codes is carried out by the VDU CONTROL ROM (IC54). This has had to be specially programmed for the TRITON and the standard Thomson-CSF ROM (designed to go with their chip) will not do in this application.</p>

<img src="man_fig9.png">

<p>To get the best use from the computer and its VDU you need to know hexadecimal and decimal values of all the ASCII codes that are used to generate alnha-numerics, graphics and control characters. You also need to know which of the keyboard keys correspond to each graphic character. To help you, we show all the graphics with their respective codes and key names in the following tables. There is no need to learn them - just keep this Manual beside your TRITON computer whenever you use it.</p>

<p>Even though you may be a software specialist, you MUST take note of the VDU's printing speed. Normally you may output a character to the VDU for printing in I/O mode every 8.3mS. The standard TRITON monitor errs on the safe side and has a built-in delay which outputs a character roughly every 9mS. If you write your own software, you must take this speed limitation into account. Furthermore, there are two I/O operations which take a considerably longer time - these are 'Clear Screen and Home Cursor' and 'Home Cursor'. These instructions must be followed by a delay of at least 132mS. Again, the TRITON's monitor makes allowance for this, but you can get direct access to these functions if you use either the 'PRINT CONTROL' or 'VDU' commands which exist in BASIC L4.1. If you use these in BASIC, you MUST follow them with a delay loop having a time constant greater than 132mS. (In practice, we have found that a 200 step 'FOR - NEXT' instruction is quite safe.) 

<h3>Modulator</h3>

<img src="man_fig10.png">

<h2>DECIMAL AND HEX CODES FOR ALPHA-NUMERIC CHARACTERS</h2>

<img src="man_fig11.png">

<table>
<tr><td><u>Character</u></td><td><u>Decimal Code</u></td><td><u>Hex Code</u></td></tr>
<tr><td>Space</td><td>32</td><td>20</td></tr>
<tr><td>!</td><td>33</td><td>21</td></tr>
<tr><td>&quot;</td><td>34</td><td>22</td></tr>
<tr><td>#</td><td>35</td><td>23</td></tr>
<tr><td>$</td><td>36</td><td>24</td></tr>
<tr><td>%</td><td>37</td><td>25</td></tr>
<tr><td>&amp;</td><td>38</td><td>26</td></tr>
<tr><td>'</td><td>39</td><td>27</td></tr>
<tr><td>(</td><td>40</td><td>28</td></tr>
<tr><td>)</td><td>41</td><td>29</td></tr>
<tr><td>*</td><td>42</td><td>2A</td></tr>
<tr><td>+</td><td>43</td><td>2B</td></tr>
<tr><td>,</td><td>44</td><td>2C</td></tr>
<tr><td>-</td><td>45</td><td>2D</td></tr>
<tr><td>.</td><td>46</td><td>2E</td></tr>
<tr><td>/</td><td>47</td><td>2F</td></tr>
<tr><td>0</td><td>48</td><td>30</td></tr>
<tr><td>1</td><td>49</td><td>31</td></tr>
<tr><td>2</td><td>50</td><td>32</td></tr>
<tr><td>3</td><td>51</td><td>33</td></tr>
<tr><td>4</td><td>52</td><td>34</td></tr>
<tr><td>5</td><td>53</td><td>35</td></tr>
<tr><td>6</td><td>54</td><td>36</td></tr>
<tr><td>7</td><td>55</td><td>37</td></tr>
<tr><td>8</td><td>56</td><td>38</td></tr>
<tr><td>9</td><td>57</td><td>39</td></tr>
<tr><td>:</td><td>58</td><td>3A</td></tr>
<tr><td>;</td><td>59</td><td>3B</td></tr>
<tr><td>&lt;</td><td>60</td><td>3C</td></tr>
<tr><td>=</td><td>61</td><td>3D</td></tr>
<tr><td>&gt;</td><td>62</td><td>3E</td></tr>
<tr><td>?</td><td>63</td><td>3F</td></tr>
<tr><td>@</td><td>64</td><td>40</td></tr>
<tr><td>A</td><td>65</td><td>41</td></tr>
<tr><td>B</td><td>66</td><td>42</td></tr>
<tr><td>C</td><td>67</td><td>43</td></tr>
<tr><td>D</td><td>68</td><td>44</td></tr>
<tr><td>E</td><td>69</td><td>45</td></tr>
<tr><td>F</td><td>70</td><td>46</td></tr>
<tr><td>G</td><td>71</td><td>47</td></tr>
<tr><td>H</td><td>72</td><td>48</td></tr>
<tr><td>I</td><td>73</td><td>49</td></tr>
<tr><td>J</td><td>74</td><td>4A</td></tr>
<tr><td>K</td><td>75</td><td>4B</td></tr>
<tr><td>L</td><td>76</td><td>4C</td></tr>
<tr><td>M</td><td>77</td><td>4D</td></tr>
<tr><td>N</td><td>78</td><td>4E</td></tr>
<tr><td>O</td><td>79</td><td>4F</td></tr>
<tr><td>P</td><td>80</td><td>50</td></tr>
<tr><td>Q</td><td>81</td><td>51</td></tr>
<tr><td>R</td><td>82</td><td>52</td></tr>
<tr><td>S</td><td>83</td><td>53</td></tr>
<tr><td>T</td><td>84</td><td>54</td></tr>
<tr><td>U</td><td>85</td><td>55</td></tr>
<tr><td>V</td><td>86</td><td>56</td></tr>
<tr><td>W</td><td>87</td><td>57</td></tr>
<tr><td>X</td><td>88</td><td>58</td></tr>
<tr><td>Y</td><td>89</td><td>59</td></tr>
<tr><td>Z</td><td>90</td><td>5A</td></tr>
<tr><td>[</td><td>91</td><td>5B</td></tr>
<tr><td>\</td><td>92</td><td>5C</td></tr>
<tr><td>]</td><td>93</td><td>5D</td></tr>
<tr><td>&#8593; or ^</td><td>94</td><td>5E</td></tr>
</table>

<h2>DECIMAL AND HEX CODES FOR NON-PRINTING CONTROL CHARACTERS</h2>

<table>
<tr><td><u>Control Function</u></td><td><u>Keyboard Key</u></td><td><u>Decimal Code</u></td><td><u>Hex Code</u></td></tr>
<tr><td>NUL (no-op for printer)</td><td>CONT @</td><td>0</td><td>00</td></tr>
<tr><td>EOT (End of Text)</td><td>CONT D</td><td>4</td><td>04</td></tr>
<tr><td>Backspace</td><td>CONT H</td><td>8</td><td>08</td><tr>
<tr><td>Step cursor RIGHT</td><td>CONT I</td><td>9</td><td>09</td></tr>
<tr><td>Line feed</td><td>Line feed or CONT J</td><td>10</td><td>0A</td></tr>
<tr><td>Step cursor up</td><td>CONT K</td><td>11</td><td>0B</td></tr>
<tr><td>Clear screen/Reset cursor</td><td>CONT L</td><td>12</td><td>0C</td></tr>
<tr><td>Carriage return/clear line</td><td>CR or CONT M</td><td>13</td><td>0D</td></tr>
<tr><td>Roll screen (top line rolls<br>round to bottom line etc)</td><td>ESC or CONT [</td><td>27</td><td>1B</td></tr>
<tr><td>Reset cursor</td><td>CONT \</td><td>28</td><td>1C</td></tr>
<tr><td>Carriage return (no clear)</td><td>CONT ]</td><td>29</td><td>1D</td></tr>
</table>

<h2>TAPE I/O (FOR GOOD MEASURE)</h2>

<p>The AY-5-1013 Universal Asynchronous Receiver transmitter features tri-state outputs for received data and all status bits. This makes it ideal for busbar orientated systems and obviates the need for any other I/O ports to interface it to the main data bus of the TRITON. Note that respective bits of the data in and data out terminals of the chip are commoned together before joining the TRITON's data bus. The Status bits of the UART are similarly commoned with the DAV (Data Available) bit tied to bit 1 on the bus, PE (Parity Error) to bit 2, FE (Framing Error) to bit 3, OR (Over Run Error) to bit 4 and TBMT (Transmitter Buffer Empty) to bit 5. There is no reason why all these flags and error messages should not be used although TRITON's standard Monitor only samples DAV and MAT. The monitor software, in its present form, does not check for errors even though parity is recorded - incidentally, ODD parity is used.</p>

<p>The DAV and TBMT flags are used to tell the computer when the UART has received and has ready a complete byte of new data or when the UART has finished a current serialising cycle and is ready to accept a new byte for transmission. In actual fact the UART will accept a second byte while it is still transmitting the first, due to the double buffering nature of its transmitter buffer.</p>

<p>The format of serialised data in TRITON is a START bit, 8 data bits, a parity bit and 2 STOP bits. These are transmitted at a rate of 300 baud set by the clock comprising IC81 (an NE 555). Baud rate is adjustable by about &#177;50 percent by means of VR2 and, of course, it is important that this is accurately set if tapes from other sources (recorded in TRITON's format) are to be played back. To obtain a rate of 300 baud, the oscillator must run at precisely 4,800 Hz and ideally this should be set on a frequency meter. We are aware that some people may have difficulty in gaining access to one of these and are prepared to supply specially recorded standard test tapes containing a few minutes of test data. If this is played into your computer with a simple machine language test routine typed into RAM you should be able to adjust VR2 until the data is reliably entered and displayed on the VDU. This will not guarantee that your clock is at 4,800 Hz because your recorder may be running at the wrong speed but it does ensure that your TRITON/Cassette Recorder pair operate TOGETHER at 300 baud. White on this subject, you may experience problems when using battery powered tape recorders and some of the cheaper varieties. For reliable operation, you should always use the SAME recorder/player and preferably a good quality mains powered machine. Batteries run down after sustained use and even the better quality recorder motors start to run more slowly when this happens. More about the tape recorder will be said later.</p>

<img src="man_fig12.png">

<p>In order to transmit data, the TRITON Monitor first checks to see whether the UART transmitter buffer is empty by activating the STATUS WORD ENABLE which is, in effect, PORT 1. This places the status word on the data bus and the computer checks to see whether bit 5 (TBMT) flag is at '1'. If so, it indicates that the UART is ready and the Monitor then outputs its data onto the busbar while activating the DATA STROBE (PORT 2). DATA STROBE starts the transmission serialising cycle and the serial data is output to the MODEM (IC82) at pin 25. If the TBMT flag was at '0' the Monitor goes into a loop and waits until the UART is ready.</p>

<p>In order to receive data, the computer asks for status information, again through input port 1, but this time checks bit 1 (the Data Available flag). This goes high as soon as a complete serial byte has been received and formatted into parallel form in the UART's output latches. The computer will loop until this condition is met. When the flag goes to '1' the computer uses port 4 to send a 'Received Data Enable' strobe to the UART. This enables the outputs of the receiver buffer latches and places the data byte on the system busbar. To prevent the system reacting a second time to the same DAV flag, the pulse from port 4 is also used to reset DAV which then stays low until a completely new byte of data is received. Clearly the computer software cycle which carries out this operation MUST have a shorter loop period than the period between one received byte and the next, otherwise overun errors will occur. This should, under normal circumstances, present no problems with the standard monitor but if you use excessively low frequency crystals for the computer's clock, you could have problems of this nature.</p>

<p>A considerable amount of thought went into the decision to use the single chip MODEM (IC82). Obviously the CUTS system represents the format used in quite a number of domestic systems, but by no means all systems are standardised on CUTS. We were also concerned about the need to line up certain types of modulator/demodulator systems and we wanted to ensure adjustment reliability. It is necessary to adjust the baud rate and any further adjustment elsewhere in the Tape I/O section would inevitably require the need for frequency measuring equipment.</p>

<p>The Motorola single chip MODEM seemed highly attractive from the word go as it is extremely economical on external components, needs no adjustment, and it operates on USA or CCITT standard frequency pairs. This is important only if the output of TRITON is interfaced to an international radio/telephone transmission system. Some radio amateurs might indeed find this extremely useful and we would like to hear from anyone who has done this.</p>

<p>The MC14412VL is such a versatile chip that it was difficult to decide in which mode it should be used. Eventually, in order to have a frequency pair that would give best reliability with most tape recorders and to allow the MODEM to receive at up to 600 baud (not that this is used at present), we opted to go for the USA standard 'originate' mode in which the transmitted frequency pair is:</p>

<ul><li>MARK ('1') = 1,270 Hz</li>
<li>SPACE ('0') = 1,070 Hz</li></ul>

<p>Clearly we need to be able to demodulate the same pair of frequencies and so have to operate in Simplex mode - hence pins 2, 10 and 14 of IC82 are allowed to be '1'. Internal pull up resistors within the chip do away with the need for external pull ups hanging on these pins. Pin 2 actually is the 'Self Test' control input which makes the MODEM's receiver demodulate the same frequency pair that is being transmitted. Keeping this active prevents any ambiguaity as to whether one is 'originating' or 'answering'. It also allows you to carry out an ECHO Self test on the MODEM by simply connecting the output to the tape recorder to the input from the tape recorder. To do this in practice would need a special test routine written in machine code as the Monitor does not contain such a test.</p>

<p>The MODEM interfaces directly with the UART and only needs a crystal and resistor to lock it to the correct frequency pairs. It is MOST important that a crystal of exactly 1.0000 MHz is used here otherwise you will be able to use pre-recorded tapes. The transmitted carrier of the MODEM is an eight level digitally synthesised sine wave of about 300mVrms which is buffered by TR1 before being fed via C27 to the tape recorder phono input. It is quite a high level signal so avoid feeding it into microphone inputs, etc. The auxiliary phono, radio or crystal cartridge inputs of most tape recorders should match satisfactorily and give flexibility in adjusting recording levels. We have found in pracice that the signal should be recorded in exactly the same way as you would handle hi-fidelity music. That is to say, you should not attempt to saturate the tape by deliberately over-recording (some systems recommend this). The output carrier is present at the output terminal all the time, so it is extremely easy to preset your recording level so that the vu meter is just indicating maximum modulation. The reason for treating the signal as Hi-Fi is that during playback the MODEM likes to see a near pure sine wave.</p>

<p>You should use an output FROM your tape recorder which provides in the order of 300mV on playback. There is considerable flexibility here and we have found that anything between about 40mV and 500mV will suffice. Preferably you should use the Phono Output from the recorder rather than the extension speaker socket. The former will always be at the same level whereas the latter depends on volume and tone control settings. With Philips equipment, and many others, this also means that you can monitor the signal over the loudspeaker as it is playing back and can manually count through the files while the computer is searching for a header. You can also keep the volume low without affecting the playback level. To carry out a demodulation satisfactorily, the MODEM IC requires a very precise unity mark/space waveform at pin 1. The tolerance on the mark/space ratio has to be better than &#177; 4%. If the carrier being played back from the recorder carries any harmonic distortion, this will be difficult to convert to a square wave of the above specification - hence the need to record in Hi-Fi. To further purify the sine wave it is amplified and filtered by TR3. To some extent the input sensitivity can be adjusted by VR3 but under normal circumstances (within the range of input voltages mentioned above) this should always be set in its mid-point position. The high purity sine wave at the collector of TR3 is fed to IC83 which is a zero crossing comparator which will sense the zero crossing of a sine wave to within about 3mV. With a good input signal this results in a square wave which more than adequately meets the input specification of the MODEM. If the input signal strength falls too low, the 3mV tolerance of the comparator starts to become more significant and variance from unity mark/space ratio can occur. If you have to err to one side or the other, always aim to provide a higher, rather than lower, input signal - but do not overdo it.</p>

<p>No provision is made to combat oxide fall out, hence you should always use good quality tapes. This, coupled with the use of a good recorder and close adherence to the above instructions (including the correct setting of the baud rate) should give you a very reliable, simple to make and easy to adjust tape I/O system.</p>

<h1>THE TRITON MONITOR<h1>

<h2>INTRODUCTION TO MACHINE CODE PROGRAMMING</h2>

<p>If you have built the TRITON computer yourself, you will want to get the best out of it, and there are several modes in which it can be used. You can write and run programs in BASIC, and you may wish to record and recall these to and from tape. To do this you need to know something about the Monitor. You may wish to use the computer for control purposes for which you need to write machine language instructions. To do this it is essential to go through the Monitor - possibly making use of some of its in-built subroutines (see the section on Monitor utilities.)</p>

<p>For those learning about computers it is a very good idea to get a grasp of machine code. It is not difficult to learn and can make life much more exciting as you will be able to get the computer to respond much more quickly than it will through a Basic Interpreter. Sometimes you can get several thousand times the speed for certain operations. To do this on the TRITON you must operate through the Monitor.</p>

<p>TRITON'S standard Monitor is a program written in machine code which is held in ROM starting at address location 0000H. Its purpose is primarily to initialise the machine and to give it an elementary intelligence so that you can communicate with it. For this reason the machine must start off at the beginning of the monitor program every time it is switched on. The first machine code instruction that the computer sees in the Monitor sets the STACK without which it would be impossible to do much in the way of decision making via nested subroutines. It then proceeds to look at the next instruction which, in the case of TRITON, enables the interrupt operation (if ever it is needed) to be used.</p>

<p>The following instruction is a JUMP which leads on to the first of the main routines called SCANMEM. This routine points to address 1600H and writes FFH into it. It then reads back the value from that address and checks that the FFH was actually stored. Furthermore it writes 00H into, the same location and checks that too. This is a check that the memory is there and working which, at the same time, leaves the memory location clear (i.e. containing 00H). The monitor routine then steps up one memory byte - to 1601H and does the same.</p>

<p>This process is carried out on every successive location from 1600H upwards until the computer finds an error. The address of the location where the error occurred is most likely to be the top of the RAM work area, but it could be the address of a faulty IC. In either event this top address is written into a pair of RAM bytes used by BASIC L4.1 to tell BASIC how much work space is available. The two bytes of memory used for this are 1481H and 1482H. As a general rule, whenever two byte instructions or data are written into memory, the 8080 microprocessor expects to see the least significant byte in the lower value of the two addresses. Thus if 2000H was the location where memory ended - as found by SCAMMEM - location 1481H would contain 00H while 1482H would contain 20H.</p>

<p>After checking the memory, the Monitor initialises the computer which acknowledges this on the screen with its standard message:</p>

<pre>TRITON READY
FUNCTION? P G I O L W T</pre>

<p>The Monitor then goes into a keyboard loop and the computer effectively waits for you to tell it what to do. This will depend on which key you depress. The letters it expects you to type are those shown in its acknowledgement, and are abbreviations for seven different primary operations you can do with the Monitor. These are:</p>

<table>
<tr valign="top"><td>P&nbsp;=</td><td>Inspect any memory location and, if necessary, change or insert a byte of data. When the data is entered the computer automatically steps to the next address showing what is currently there and waits to see if you wish to change it.</td></tr>
<tr valign="top"><td>G&nbsp;=</td><td>Start running a program from any specified starting address location. The computer asks you, within this routine, what start location you want.</td></tr>
<tr valign="top"><td>I&nbsp;=</td><td>Input from tape recorder. The computer asks you for the header code of the file and then searches for it. When it has been found the data is written into the computer's memory starting at location 1600H. When the flag marking the end of the record has been found, the computer re-initialises with an abbreviated form of its initial 'switch on' message.</td></tr>
<tr valign="top"><td>O&nbsp;=</td><td>Output a program to the tape recorder. This, again, asks you to give your recording a header code. The routine automatically outputs programs written in BASIC and stops when it gets to the end of file address (the address written into bytes 1600H and 1601H by BASIC). For user-written machine code programs you have to manually enter the address immediately following your last instruction into these two bytes. Tapes are ALWAYS loaded and dumped with 1600H being the start location. When dumping has finished the computer re-initialises.</td></tr>
<tr valign="top"><td>L&nbsp;=</td><td>List the machine code content of all locations starting from any specified address. The computer asks for the first address then prints out the contents of this and the next 14. It then asks MORE? and expects you to type Y otherwise it re-initialises.</td></tr>
<tr valign="top"><td>W&nbsp;=</td><td>Typewriter mode. The computer behaves just as if it was a keyboard and VDU. Anything you type is displayed on the screen including graphics. Cursor control and special VDU functions (e.g. Clear Screen, Reset Cursor, etc) all operate, but the computer responds to nothing except CONTROL C which makes it re-initialise.</td></tr>
<tr valign="top"><td>T&nbsp;=</td><td>Jump to BASIC L4.1. This command causes the computer to jump out of the control of the Monitor into the control of BASIC. See the section which is entirely devoted to this. CONTROL C will jump back out of BASIC into the initialisation condition of the Monitor.</td></tr></table>

<p>Note that CONTROL C will, in nearly all cases, get you out of an operation and back to the initialisation condition. The only times when it fails to do this are when you are locked in a user-written machine code program loop, searching tape for a non-existant header or outputting to the tape recorder. In these three cases you will have to use Interrupt 2 (which re-initialises without clearing memory) or RESET which goes through the SCANNEM routine and erases any data in memory.</p>

<p>When the computer asks for its initial instruction via one of the above letters you simply have to type the letter. No carriage return is needed. If you type the wrong letter, the computer replies 'INVALID' and waits for you to try again.</p>

<p>Here are some examples to try with the above functions:</p>

<h3>P Function</h3>

<p>Type P. The computer acknowledges with PROG START = and expects you to enter a four digit hexadecimal code as a start address. Try typing in 123M followed by a carriage return (CR). The computer says INVALID and re-initialises because you entered M as one of the digits. If you make a mistake typing in a character, you have a chance to correct it by backspacing with CONTROL H until you get to the error. Overtype the error, and continue overtyping the line until you get to where you were. Now press CR - the computer will confirm the start address by retyping it, and will then follow this with a space and the hexadecimal code of the contents at that location. In this case 3E. Depress CR again and you will step to the next location and so on all the way through memory if you so desire. This is the mode for manually inspecting memory locations.</p>

<p>Re-initialise with CONTROL C and type P again. This time we shall use the function to enter data, so we shall start at an address in RAM. Enter 1600 as the start address and depress CR. This time you will see the data currently in 1600 which you can change by typing two more hexadecimal digits. If you type more than two it is only the first pair that the computer recognises, so if you make a mistake use the CONTROL H key to backspace. When you press CR the new data is entered into that location and the address is stepped on. When, at a later time, you come to enter a program in machine code, you should use this method.</p>

<p>Here is a simple machine code program that you can type in, starting at address 1600, which we can use when we test the G function. The program instructs the computer to type the numbers 0 to 9 inclusive, and to keep repeating this sequence. The left-hand column is an aide memoire of the instruction's address (you only have to type this in on one occasion - when the computer asks for the start). The second column is the mnemonic of the machine code (dashes indicate that these locations carry data to go with the previous instruction). Some mnemonics are qualified with the name of the OPERAND - usually when the instruction requires the operand to be identified in the bytes following the instruction. The next column is the data that you should type in and the remarks describe what the instructions do in everyday language.</p>

<pre>
1600   MVI A   "0"      3E   Enter the ASCII code for 0
1601   -                30     into the accumulator.
1602   CALL    OUTCH    CD   Call subroutine which outputs
1603   -                13     code currently in accumulator
1604   -                00     to the VDU.
1605   INR A            3C   Increment the accumulator.
1606   CPI     3AH      FE   Check if code in accumulator is 
1607   -                3A     one greater than that for 9.
1608   JNZ     1602H    C2   If it is not, jump back to
1609   -                02     address 1602 and loop until
160A   -                16     9 is reached.
160B   CALL    PCRLF    CD   When it is reached call
160C   -                33     carriage return/line feed
160D   -                00     output subroutine.
160E   JMP     1600H    C3   Jump back to beginning of
160F   -                00     program and keep repeating.
1610   -                16
</pre>

<p>The two called subroutines OUTCH and PCRLF are utilities within the Monitor.</p>

<h3>G Function</h3>

<p>This function permits you to run a program from any start location you care to specify. If you have already entered the above program you can try running it. Make sure you are initialised (by using CONTROL C or Interrupt 2) and then type G. The computer acknowledges with RUN PROG START=. Type in 1600 (the start of the above program) and as soon as you press CR the program will execute. This particular program is typical of many user programs in that it stays locked in its own loop and you cannot get out of it by typing CONTROL C. You will have to use Interrupt 2.</p>

<p>Try writing and running the following simple program at 1600 that will jump immediately back into the Monitor to re-initialise.<p>

<pre>
1600   JMP     RST0     C3   Jump to restart 0
1601   -                00
1602   -                00
</pre>

<p>Just enter these three instructions using P and run them using G. The computer will act as if it had been reset to a switch on condition (i.e. will clear all memory and completely re-initialise). This is an instruction which should normally be avoided or you will delete your program!</p>

<h3>O Function</h3>

<p>We shall deal with this before covering tape input. O transfers control to the tape output routine and it can be used for dumping either BASIC or machine code programs to tape. The only stipulation is that all programs MUST start at 1602H. The reason is that the routine is designed for BASIC, and to save space we have deliberately avoided writing a second routine to deal with user programs. There are, however, no major problems.</p>

<p>First of all type the following short program into RAM starting at address 1602. The program uses another of the Monitor utilities (PDATA) which prints out any string of ASCII codes in memory starting at a specified location. We shall use it to print out repeatedly the TRITON's initialisation message.</p>

<pre>
1602   LXI D   0377H    11   Load DE register pair with
1603   -                77     start address of string.
1604   -                03
1605   CALL    PDATA    CD   Call subroutine which prints
1606   -                23     string of characters and
1607   -                00     returns when it sees 04.
1608   JMP     1602H    C3   Jump back to start of program
1609   -                02     to repeat.
160A   -                16
</pre>

<p>Note that the address immediately following this program is 160B - we shall be making use of this in a moment. Before that, verify that the program runs by using G and then Interrupt 2 to get out of the loop (DO NOT use RESET or you will erase your program!)</p>

<p>During the tape output routine the software needs to know how long the program is that it is dumping. This is defined by the bytes in address locations 1600 and 1601. The locations must contain the low order and high order bytes of the address immediately after the end of the prgram to be saved. This is done automatically by BASIC but you have to do this manually if you wish to save user programs. Use the P function to enter this information manually in the two bytes starting at 1600. These should be 0B and 16 respectively (note that the low order byte goes in first). When you have done this, re-initalise with CONTROL C and you are ready to save your program.</p>

<p>Connect up the audio leads of your recorder to the TRITON (including remote control if you have one). Depress the manual override button on TRITON (if necessary) and find a suitable place on a tape - preferably the beginning! Carry out a dummy run record to set the recording level against the carrier frequency of TRITON - just maximum on the VDU meter. Rewind, and get ready to start. Take your finger off the manual override button and then type O into TRITON. It will acknowledge with TAPE HEADER=. You should now enter a header code of your own choosing - but don't forget what it was! We suggest you use PRINT ROUTINE 1. Note that you can use free text alpha-numerics in the header but the length should not exceed 20 characters. Before pressing CR set the recorder to RECORD and then you can press CR. It will take about 15 seconds to record this program - including about 5 to 6 seconds at either end as guard gaps.</p>

<p>The recording format is as follows:<p>

<ul><li>5 to 6 seconds of unmodulated carrier</li>
<li>64 carriage return codes as start file code</li>
<li>The header code</li>
<li>Contents of every memory location starting at 1600 byte by byte</li>
<li>5 to 6 seconds of unmodulated carrier</li></ul>

<p>When recording has finished, the computer will type END and re-initialise and, if the remote control lead is used, the tape recorder will switch off. YOU must then switch off the tape recorder's own control. Hopefully you will now have your program on tape. Rewind the recorder and play back the record over its loudspeaker to check that at least something went on! If you are satisfied, you can switch the computer off at the mains. Switch it on again, and then proceed to try the Tape Input function. Note that, if you intend to save a program written in BASIC, you must do exactly the same operations except that you can omit manually entering the end of file address. To save BASIC, you must jump out of BASIC via CONTROL C in order to pick up the O function.</p> 

<h3>I Function</h3>

<p>The procedure to input from a tape is the same for machine code programs as for BASIC. Connect up the audio leads and find the start of the file manually (if you can). If the file you want is somewhere in the middle of the tape you will have difficulty doing this, and will have to rely on the Input function's ability to search. If you have a long tape this could take quite some time. Do not record too many files onto a tape - 4 or 5 averaging 1 minute each is sufficient (and it is easier to index the tapes). Switch on the computer, and when it is initialised type in I. The computer will respond with TAPE HEADER= and you should then type in the header code EXACTLY, including all spaces and punctuation if there were any. Before pressing carriage return, make sure that the tape is rewound to BEFORE the place where your file starts. It does not matter if you are currently sitting in the middle of the previous file, because the input routine will ignore it. Set the recorder to play, and press CR. If you can, monitor the sound of the recording. Files having the wrong header code will be skipped over, but when the computer has made a perfect match with the code entered it will accept the input data, and when it comes to an end the computer types END, switches the tape off (if remote is being used) and re-initialises.</p>

<p>All you have to do is run the program. If it was a machine code program you must type G followed by 1602 and then CR. For BASIC, type T and then RUN, followed by CR.</p>

<h3>L and W Functions</h3>

<p>These have been described fully already. L lists what is in adjacent memory locations in blocks of 15 bytes (so that you can inspect the screen before it continues). At the end of a block it asks MORE? and continues if you type Y (no carriage return is needed). Any other character will be flagged INVALID, and the computer will re-initialise.</p>

<p>The W function has also been described elsewhere; it turns the machine into a video typewriter. No key characters are recognised, and no default conditions can arise. CONTROL C is the only way of re-initialising apart from Interrupt 2 and RESET.</p>

<h2>MEMORY AND PORT DESIGNATIONS</h2>

<p>To help those who wish to get involved in machine code programming at an early stage, here are the addresses of memory blocks and ports. It is assumed that you will be operating under the control of the standard Monitor program, so we also list the addresses of its main Utilities.</p>

<h3>Memory Start Addresses</h3>

<table>
<tr valign="top"><td>0000H&nbsp;-&nbsp;03FFH</td><td>1k&nbsp;EROM</td><td>(Holds standard MONITOR)</td></tr>
<tr valign="top"><td>0400H&nbsp;-&nbsp;07FFH</td><td>1k&nbsp;EROM</td><td>(Holds BASIC L4.1 "A")</td></tr>
<tr valign="top"><td>0800H&nbsp;-&nbsp;0BFFH</td><td>1k&nbsp;EROM</td><td>(Holds BASIC L4.1 "B")</td></tr>
<tr valign="top"><td>0C00H&nbsp;-&nbsp;0FFFH</td><td>1k&nbsp;EROM</td><td>(Spare location)</td></tr>
<tr valign="top"><td>1000H&nbsp;-&nbsp;13FFH</td><td>1k&nbsp;RAM</td><td>(VDU memory - can only be written into by computer)</td></tr>
<tr valign="top"><td>1400H&nbsp;-&nbsp;14FFH</td><td>&frac14;k&nbsp;RAM</td><td>(Holds stack and tables for Monitor from 1400H to 147FH; 1480H upwards through this block will be used by BASIC L4.1 tables, otherwise is free as M/C code work area)</td></tr>
<tr valign="top"><td>1500H&nbsp;-&nbsp;15FFH</td><td>&frac14;k&nbsp;RAM</td><td>(Completely reserved for BASIC L4.1 stack, otherwise is free for the user)</td></tr>
<tr valign="top"><td>1600H&nbsp;-&nbsp;1FFFH</td><td>2&frac12;k&nbsp;RAM</td><td>(Work area for BASIC L4.1 or user programs. Note that locations 1600H and 1601H are made use of by tape I/O routines to store End of File address - hence user programs for saving/loading to and from tape should always start at 1602H - see the section describing the Monitor)</td></tr>
<tr valign="top"><td>2000H&nbsp;-&nbsp;FFFFH</td><td>56k</td><td>Available for "Off Board" extensions</td></tr>
</table>

<h3>Port Designations</h3>

<table>
<tr><td>00H</td><td>Keyboard INPUT (note special routine is necessary)</td></tr>
<tr><td>01H</td><td>Tape I/O UART Status INPUT</td></tr>
<tr><td>02H</td><td>Tape I/O UART Data Strobe (start transmission) OUTPUT</td></tr>
<tr><td>03H</td><td>LEDs OUTPUT (note LEDs are on for "0")</td></tr>
<tr><td>04H</td><td>Tape I/O UART Receive Data Enable (receive data) INPUT</td></tr>
<tr><td>05H</td><td>VDU OUTPUT (note strobe - bit 8 - has to be specially formatted by software)</td></tr>
<tr><td>06H</td><td>Spare OUTPUT (note only bits 7 and 8 are output)</td></tr>
<tr><td>07H</td><td>Relay OUTPUT (note bit 8 is used to drive tape control relay out, bit 7 is used as a spare line)</td></tr>
<tr><td>08H - FFH</td><td>Available for "Off Board" extensions</td></tr>
</table>

<h2>MONITOR UTILITIES</h2>

<table>
<tr valign="top"><td>0000H</td><td>RST0</td><td>Reset address. Enables Interrupt and checks and clears memory writing number of bytes available into locations 1481H (low order byte) and 1482 (high order byte). With full main board memory in place this should read 2000H. Then goes on to initialise computer.</td></tr>
<tr valign="top"><td>0008H</td><td>RST1</td><td>Reacts to Interrupt 1 clearing VDU and resetting cursor.</td></tr>
<tr valign="top"><td>000BH</td><td>INCH</td><td>A CALL routine which inputs character from keyboard. Stays in keyboard loop until key is depressed.</td></tr>
<tr valign="top"><td>0010H</td><td>RST2</td><td>Reacts to Interrupt 2, clearing VDU and initialising computer without clearing memory. Used for normal reset operation.</td></tr>
<tr valign="top"><td>0013H</td><td>OUTCH</td><td>A CALL routine which outputs character to VDU.</td></tr>
<tr valign="top"><td>0018H</td><td>RST3</td><td>Reacts to Interrupt 3 and re-vectors to 1618H for user routine.</td></tr>
<tr valign="top"><td>001BH</td><td>INDATA</td><td>A CALL routine which allows string of characters to be entered to any place in memory. Start location of string pointed to by DE register pair which must be pre-loaded before calling INDATA. Returns on Carriage Return.</td></tr>
<tr valign="top"><td>0020H</td><td>RST4</td><td>Reacts to Interrupt 4 and re-vectors to 1620H for user routine.</td></tr>
<tr valign="top"><td>0023H</td><td>PDATA</td><td>A CALL routine which allows string of characters to be printed from any place in memory. DE register pair must be pre-loaded with start address before calling. Routine returns when it sees EOT terminator (04H) but DE steps to one address beyond terminator allowing immediate recall for further string to be printed.</td></tr>
<tr valign="top"><td>0028H</td><td>RST5</td><td>Reacts to Interrupt 5 and re-vectors to 1628H for user routine.</td></tr>
<tr valign="top"><td>002BH</td><td>PSTRNG</td><td>A CALL routine identical to PDATA, except that it outputs Carriage Return/Line Feed prior to printing string.</td></tr>
<tr valign="top"><td>0030H</td><td>RST6</td><td>Reacts to Interrupt 6 and re-vectors to 1630H for user routine.</td></tr>
<tr valign="top"><td>0033H</td><td>PCRLF</td><td>A CALL routine which prints Carriage Return followed by Line Feed, and then returns with the original contents of accumulator intact.</td></tr>
<tr valign="top"><td>0038H</td><td>RST7</td><td>Reacts to Interrupt 7 and re-vectors to 1638H for user routine.</td></tr>
</table>

<p>The above are fixed location utilities whereas the following are within the main body of the Monitor which are liable to be relocated if new generation monitors are written. They are, nonetheless, very useful and can save a lot of redundant instructions elsewhere. Note that you can only guarantee using these if you have MONITOR V4.1 on board!</p>

<table>
<tr valign="top"><td>0053H</td><td>INIT</td><td>Destination of Interrupt 2. Clears screen and initialises computer. Also resets stack, so should only be used as destination of a JUMP instruction.</td></tr>
<tr valign="top"><td>00AAH</td><td>BASICIN</td><td>Checks to see if a key has been depressed on keyboard. If it has, it returns with the data - otherwise it returns immediately with the accumulator cleared and flags set accordingly. Useful for real time interactive programs.</td></tr>
<tr valign="top"><td>010DH</td><td>DLY</td><td>When called introduces approximately 3mS time delay and returns with all registers (except flags) intact.</td></tr>
<tr valign="top"><td>0116H</td><td>FIVSEC</td><td>When called introduces a delay of between 5 and 6 seconds. Returns with registers and flags intact.</td></tr>
<tr valign="top"><td>0134H</td><td>CLRSCN</td><td>Clears screen and resets cursor. Approximately 200mS time delay is built into this routine. Returns with registers and flags intact.</td></tr>
<tr valign="top"><td>02B9H</td><td>REINIT</td><td>This should only be used as a JUMP destination. It resets the stack and re-initialises the computer WITHOUT clearing the screen. A useful instruction at the end of user programs to avoid having to use the HLT instruction.</td></tr>
<tr valign="top"><td>0327H</td><td>TPEON</td><td>When called switches the tape control relay on (relay contacts could be used for other control purposes by the user). Note that routine returns with 80H in accumulator.</td></tr>
<tr valign="top"><td>032CH</td><td>TPEOFF</td><td>When called switches the tape control relay off. Routine returns with OOH in accumulator.</td></tr>
<tr valign="top"><td>03A1H</td><td>ACKA</td><td>Start address of string which prints INVALID. Use should be made of PSTRNG utility to insert Carriage Return and Line Feed.</td></tr>
<tr valign="top"><td>0385H</td><td>ACKB</td><td>Start address of string which prints START=. (Use via PSTRNG)</td></tr>
<tr valign="top"><td>03C4H</td><td>ACKC</td><td>Start address of string which prints HEADER=. (Use via PSTRNG)</td></tr>
<tr valign="top"><td>03CFH</td><td>ACED</td><td>Start address of string which prints END. (Use via PSTRNG)</td></tr>
</table>

<h2>USING THE MONITOR IN MACHINE CODE PROGRAMS</h2>

<p>There are 6 fixed location utility subroutines located in a jump table in the early part of the Monitor. These are designated INCH, OUTCH, INDATA, PDATA, PSTRNG, and PCRLF. We have used a couple already. (Their addresses and descriptions are given in the section on Monitor Utilities.) There are also 2 interrupts which are brought out to push buttons on the front panel. These are dedicated, but a third is available for the user. INT1 clears the screen and resets the cursor, but can only be used once unless a keyboard input follows it. (Interrupts are re-enabled within the keyboard input routine.) INT2 is the reset which does not clear memory. INT3 is spare and contains a jump instruction to 1618H which can be used for your own routine. It is NOT ADVISABLE to use INT3 unless you have a properly formatted interrupt routine sitting in that location, as you could corrupt any other programs in memory! Interrupts 4 to 7 are brought out on TRITON's extender socket. See the table for the re-vectored addresses of these. You can use INT1 as a subroutine to be called. It jumps to the CLRSCN (Clear Screen) routine elsewhere in the Monitor and this is terminated by a RETURN. Here is an example of a user-written interrupt routine using INT3. Note that it starts at the re-
vectored start address 1618:</p>

<pre>
1618   LXI D   161FH    11   Load start of string saving
1619   -                1F     I AM INTERRUPT 3
161A   -                16
1615   CALL    PSTRNG   CD   Print carriage return
161C   -                2B     followed by string.
161D   -                00
161E   RET              C9   Return to main program.
161F   DATA    I        49   String data starts here and
1620   -       SPACE    20     terminates with end of
1621   -       A        41     text marker 04.
1622   -       M        4D
1623   -       SPACE    20
1624   -       I        49
1625   -       N        4E
1626   -       T        54
1627   -       E        45
1628   -       R        52
1629   -       R        52
162A   -       U        55
162B   -       P        50
162C   -       T        54
162D   -       SPACE    20
162E   -       3        33
162F   -       EOT      04
</pre>

<p>Load this program then re-initialise and momentarily connect INT3 to ground. Next press W and type on the screen, activating INT3 from time to time. The interrupt should announce its presence. We hope that this simple example will show you that, contrary to popular belief, interrupts are quite easy to write programs for.</p>

<p>Apart from the fixed location utilities there are a few other useful ones within the Monitor. These are listed and briefly described in the table. Use the table to see if you can analyse the following machine code programs which are designed to lead you through most of them.</p>

<p>We know that some readers will be completely new to computing and may never have come across machine code programming before; others will have had some experience of BASIC, and some will be very experienced. In order to make this Manual of value to all parties, we have designed some experimental programs which, hopefully, will be sufficient to give the more experienced all they need to know about the Monitor, so that they can quickly go on to write their own software. We cannot possibly hope to illustrate all permutations and combinations of the wide range of instructions in the 8080 machine code set, but by frequent use of a few we will try to show, by example, how these are used. Those with less or no experience should work their way through the examples, and by seeing the same sort of pattern emerging - particularly with JUMPS and CALLS - they will soon start to see how a program can be built up. It is advisable, however, to do a lot more reading to get to grips with the full 8080 instruction set (a list of further reading is given at the end of the Manual). There are many excellent books on the subject - one of the advantages of using an 8080 in TRITON!</p>

<h3>Video Typewriter Program</h3>

<pre>
1600   LXI D   1612H    11   Load start address of message
1601   -                12     string in DE register pair.
1602   -                16     This is required by PSTRNG subroutine.
1603   CALL    PSTRNG   CD   Call subroutine which prints
1604   -                28     string starting at address
1605   -                00     held in DE register pair.
1606   CALL    PCRLF    CD   Call subroutine which prints
1607   -                33     out carriage return and
1608   -                00     line feed.
1609   CALL    INCH     CD   Call subroutine which inputs
160A   -                0B     data from keyboard and
160E   -                00     holds this in accumulator.
160C   CALL    OUTCH    CD   Call subroutine which prints
160D   -                13     out ASCII character from
160E   -                00     data in accumulator.
160F   JMP     1609H    C3   Jump back to address 1609H and
1610   -                09     wait for next character from
1611   -                16     keyboard. 
1612   DATA    O        4F   Start address of message string. 
1613   -       /        2F
1614   -       K        4B
1615   -       SPACE    20
1616   -       T        54
1617   -       Y        59
1618   -       P        50
1619   -       E        45
161A   -       !        21
161E   -       EOT      04   End of text terminator code.
</pre>

<p>When you run this program, it acknowledges with the message O/K TYPE! and you can then use the TRITON as if it were in the W function operating mode (i.e. it becomes nothing more than a video typewriter). You can escape from the program by depressing CONTROL C (this applies to any program which repeatedly goes through the INCH routine).</p>

<h3>Duo-decimal String Program</h3> 

<p>The following program starts by stepping onto the next line of the VDU and waiting for you to type in your own message String. This can be of any length (limited only by the amount of memory you have on board) and you can use any alpha-numeric or graphic characters, but there are a few exceptions. You should not use CONTROL D as this will enter the EOT code. Carriage return should only be depressed at the end of your message as it is used to step the program onto its second phase. You CAN use control codes in the string to step the cursor down and do a non-line erasing carriage return (see relevant table). When you depress the normal carriage return key the computer repeats your message 12 more times and then re-initialises without clearing the screen.</p>

<pre>
1600   CALL    PCRLF    CD   Print carriage return and
1601   -                33     line feed.
1602   -                00
1603   LXI D   1618H    11   Set DE register pair to point to
1604   -                18     start address of input buffer
1605   -                16     required by INDATA subroutine.
1606   CALL    INDATA   CD   Call subroutine which allows string
1607   -                1B     to be input to buffer starting
1608   -                00     at address held in DE reguster pair.
1609   MVI B   0CH      06   Set the decimal number 12 (0CH)
160A   -                0C     in register B. This specifies
                               the number of times the line is
                               to be repeated.
1603   LXI D   1618H    11   Reset DE register pair to point
160C   -                18     to start of input buffer.
160D   -                16
160E   CALL    PSTRNG   CD   Print string starting at address
160F   -                23     held in DE register pair.
1610   -                00
1611   DCR B            05   Decrement contents of reguster
                               B by one.
1612   JNZ     160BH    C2   If register B is not decremented
1613   -                0B     to zero jump back to 160BH
1614   -                16     and print start again.
1615   JMP     REINIT   C3   If B is at zero program has
1616   -                B9     finished, so jump to REINIT
1617   -                02     to return control to Monitor
                               without clearing screen.
1618   BUFFER                Start address of input buffer.
</pre>

<p>Note that the REINIT subroutine is NOT at a fixed location except in MONITOR V4.1. Nonetheless it is very useful as it enables you to jump out of a user program back into the Monitor without clearing the screen.</p>

<h3>Keyboard/LED Program Version 1</h3>

<pre>
1600   CALL    INCH     CD   Input data from keyboard
1601   -                0B     to accumulator.
1602   -                00
1603   CMA              2F   Complement contents of accumulator.
1604   OUT     PORT 03H D3   Output contents of accumulator
1605   -                03     to port 3 (LED port).
1606   JMP     1600H    C3   Jump back to 1600H for next
1607   -                00     input from keyboard.
1608   -                16
</pre>

<p>This program enables you to test out both the LED port and the keyboard by outputting the binary code from the keyboard to the LEDs. The program complements the accumulator to compensate for the fact that on TRITON the LEDs go on for level '0'. In this program they will go on if a bit from the keyboard is '1'. Because we are going through the Monitor's INCH routine, you will find that a shift inversion takes place. You get upper case alpha codes when unshifted and lower case alpha codes when shifted. This is designed in to make the keyboard more convenient to use. Numerical keys are not affected by the shift inversion. Again, because we are using INCH you can escape from this program loop with CONTROL C. You will notice that the most significant LED (bit 8) is permanently off - this is because bit 8 is used for the input strobe and this bit is masked off by the Monitor as data is entered. Notice also that the data is latched onto the LEDs after the key has been released.</p>

<h3>Keyboard/LED Program Version 2</h3>

<p>This program does exactly the same as the one just described, but is written without the use of any subroutines. We are, in effect, writing into the program a simplified form of the INCH subroutine. We say 'simplified' because we are NOT going to introduce a keyboard inversion this time. The program also introduces the newcomer to some machine code logic followed by a decision. The logic in question checks whether a key has been depressed. If it has not, the program waits in a loop, and only after a depression will it continue.</p>

<pre>
1600   IN      PORT 00H DB   Input data from keyboard
1601   -                00     port to accumulator.
1602   MOV B,A          47   Copy contents of accumulator
                               to B register AND
1603   ANI     80H      E6     accumulator with 10000000
1604   -                80     (binary), to see if bit 8
                               is '1' or '0'.
1605   JZ      1600H    CA   If it is '0' jump back to
1606   -                00     1600H and wait for key
1607   -                16     to be depressed.
1608   MOV A,B          78   If it is '1' restore data
                               in accumulator.
1609   CMA              2F   Complement accumulator.
160A   OUT     PORT 03H D3   Out put contents of accumulator
160E   -                03     to port 3 (LED port).
160C   JMP     1600H    C3   Jump back to 1600H and wait
160D   -                00     for next key to be
160E   -                16     depressed.
</pre>

<p>Bit 8 is not masked off this time, and will be permanently at '1'. Note that with the program as it stands you cannot escape via CONTROL C and will have to use Interrupt 2. You can, however, modify it to escape on CONTROL C by changing and adding a few instructions starting at 160CH. Try adding the following:</p>

<pre>
160C   CPI     03E      FE   Compare contents of
160D   -                03     accumulator with 03H
                               (ASCII code for CONTROL C) 
160E   JZ      REINIT   CA   If comparison is valid
160F   -                B9     jump to REINIT and
1610   -                02     escape from program loop.
1611   JMP     1600H    C3   Otherwise jump back to 1600E
1612   -                00     and wait for next key
1613   -                16     depression.
</pre>

<h3>Alphabet Twelve Times Over Using I/O</h3>

<p>This program should be compared with the one following, as they both do the same thing - print the alphabet twelve times and then re-initialise. This first program uses the conventional I/O techniques, whereas the second makes use of the powerful memory mapped option to the TRITON's VDU. We hope you will recognise the tremendous difference in speed of operation between the two methods. Note that in both programs we make use of the RST1 instruction at the beginning. This is one of 8 special re-start instructions which are fixed destination CALL instructions. Using RST1 will call the subroutine at location 0008H, which, in the case of TRITON's Monitor, is then re-vectored with a jump to 0134H. The routine in question is the one which clears the VDU screen and resets the cursor. The advantage of using a RST instruction is that you do not have to specify the address of the subroutine, hence saving two bytes in your program. You should only use RST instructions if the subroutine being called terminates in a RETURN command.</p>

<pre>
1600   RST1             CF   Clear screen via special
                               restart instructions.
1601   MVI B   0CH      06   Set decimal value 12 (0CH)
1602   -                0C     in B to specify number
                               of alphabets required.
1603   MVI A   41H      3E   Set ASCII code for 'A' in
1604   -                41     accumulator.
1605   CALL    OUTCH    CD   Print contents of accumulator.
1606   -                13
1607   -                00
1608   INR A            3C   Increment ASCII code in
                               accumulator by one.
1609   CPI     5BH      FE   Compare it with ASCII code
160A   -                58     which is one greater than Z.
160B   JNZ     1605H    C2   If not greater than Z jump back
160C   -                05     to 1605H and repeat until
160D   -                16     complete alphabet is printed.
160E   CALL    PCRLF    CD   If alphabet is completed output
160F   -                33     carriage return and line
1610   -                00     feed.
1611   DCR B            05   Decrement value in B register by one.
1612   JNZ     1603H    C2   If it is not zero we do not
1613   -                03     have 12 alphabets, so jump
1614   -                16     back to 1603H and repeat.
1615   JMP     REINIT   C3   If it is zero, re-initialise.
1616   -                B9
1617   -                02 
</pre>

<p>When you run the program try and judge the time it takes to display the 12 alphabets and then go on to the next example.</p>

<h3>Alphabet Twelve Times Over Using Memory Mapping </h3>

<p>Although this program is longer than the one just described, you will see an element of similarity in the way the alphabet is formed (by incrementing the accumulator) and we keep track of the number of alphabets in the B register. Instead of using the I/O OUTCH routine, we use the HL register pair to point to memory locations which are within the block of the VDU's RAM. This starts at 1000H and finishes at 13FFH. We then use the MOV M,A instruction which copies whatever is in the accumulator to the memory location being addressed by the HL register pair. By using the INX H instruction we can increment the latter to display the next character etc. Notice that carriage returns and line feeds are not needed in the main body of the program because we are using addressing to tell the computer exactly where to place each character. When one alphabet is finished we have to compute the address of the start of the next by adding the hex number 26 to the address currently in the HL register pair (this is done at instruction 1611H). Notice that, after this operation, we have to make allowance for a carry by calling an INR H subroutine.</p>

<pre>
1600   RST1             CF   Clear screen with special
                               restart instruction.
1601   LXI H            21   Load HL register pair with
1602   -                FF     address one less than start
1603   -                0F     of VDU RAM.
1604   MVI B   0CH      06   Set number of alphabets
1605   -                0C     required in register B.
1606   MVI A   41H      3E   Set ASCII code for 'A' in
1607   -                41     accumulator.
1608   INX H            23   Increment HL register pair by one.
1609   MOV M,A          77   Copy contents of accumulator to memory.
160A   INR A            3C   Increment contents of accumulator.
1608   CPI    5BH       FE   Compare contents of accumulator
160C   -                5B     with code one greater than Z.
160D   JNZ    1608H     C2   If it is not greater than Z
160E   -                08     jump back to 1608H and
160F   -                16     repeat.
1610   MOV A,L          7D   If it is, copy contents of L
                               to accumulator.
1611   ADI     26H      C6   Add 26H to this value.
1612   -                26
1613   CC      1629H    DC   If addition causes a carry,
1614   -                29     call subroutine which
1615   -                16     increments H register by one.
1616   MOV L,A          6F   Replace new low byte address
                               in register L.
1617   DCR B            05   Decrement register B by one.
1618   JNZ     1606H    C2   If it is not zero we do not have
1619   -                06     12 alphabets, so jump back
161A   -                16     to 1606H and repeat.
1618   MVI B   0CH      06   Set decimal value 12 into
161C   -                0C     B register.
161D   MVI A   0AH      3E   Set accumulator to ASCII code
161E   -                0A     for line feed.
161F   CALL    OUTCH    CD   Output line feed -o VDU to step
1620   -                13     cursor down (to get it clear
1621   -                00     of last alphabet).
1622   DCR B            05   Decrement register B by one.
1623   JNZ     161FH    C2   If it is not zero we have not
1624   -                1F     stepped cursor to below the
1625   -                16     last line of alphabet, so
                               jump back to 161FH and repeat.
1626   JMP     REINIT   C3   If it is zero, re-initialise.
1627   -                B9
1628   -                02
1629   INR H            24   Subroutine to increment register
162A   RET              C9     H in event of a carry.
</pre>

<p>When memory mapping the VDU, you must remember that the Clear Screen/Reset Cursor operation does more than is immediately apparent to the eye. The addresses of different positions on the VDU screen must correspond to specific places on the screen (1000H is the top left-hand corner and 13FFH is the bottom right-hand corner). If, as a result of previous activity, the VDU screen has been scrolling, these absolute address values do not correspond with the absolute positions on the screen. To make sure that addresses correspond to positions in an absolute manner, you must carry out a cursor reset operation. This can be on its own or combined with the clear screen operation. A similar operation must be carried out if you use the VDU function when under the control of BASIC L4.1. Note that it takes the VDU 132mS to carry out a home cursor operation, so if ever you output the raw instruction in your own software, you must introduce a time delay greater than this before outputting anything else to the VDU. The Clear Screen/Reset Cursor utility in the Monitor has a delay of about 200mS built into it, so you can call it without introducing any further delay.</p>

<p>Note that when this program runs the cursor stays stationary in its reset position (top left-hand corner of the screen). If we allowed it to stay there the re-initialisation message would overprint our alphabets, so we have included some extra instructions (starting at 161BH) which step the cursor down twelve positions immediately prior to re-initialisation.</p>

<p>To further demonstrate the flexibility of memory mapping you can alter the layout on the screen by altering the value added to the address to get the next line. Alter the data at location 1612H to 29 and re-run the program. The lines should have start points staggered by 3 character positions. Similarly you can alter the start location for the display as a whole by altering the data in locations 1602H and 1603H. Try making these 20 and 10 respectively and alter the data at 1612H to 25. When you run the program the rows should slant the other way.</p>

<p>When memory mapping the VDU you must always be careful to ensure that your memory pointer (HL register pair) cannot exceed the highest address of VDU (13FFH), otherwise you will start overwriting the input buffer and stack area of the Monitor. If this happens all sorts of strange things will begin to take place, and you will probably find that you completely lose control through the keyboard. If this should happen, you must resort to the RESET button and end up with a cleared memory!</p>

<h3>Screen Flash Program</h3>

<p>To further demonstrate the speed of memory mapping the VDU, you might like to try the following program, which alternately makes the whole screen clear and then white (all but the top line, that is). By selecting different values for the timing byte in location 160FH, you can make the screen flash on and off at different speeds. Note that we use the INX H instruction to sequence through all the relevant VDU locations (at location 1606), and immediately follow it by a check to see that we have not exceeded the VDU area. We do this by comparing the high order byte of the pointer register with 14. If a comparison is true, the program breaks out of its incrementing loop.</p>

<p>The newcomer should take note of the time delay routine between address locations 160DH and 1615H. Routines of this type are very commonly used in programs and they usually work by pre-setting a value in a register or, as in this case (to get a long delay), a register pair. The value is then repetitively decremented by a looping program until the value in the register/s becomes zero. The higher the number that is pre-set the greater will be the delay. Try typing the program in and running it.</p>

<pre>
1600   MVI B   20H      06   Set ASCII code for SPACE
1601   -                20     in register B.
1602   LXI H   1040H    21   Set memory pointer to address
1603   -                40     of start of second line
1604   -                10     on VDU.
1605   MOV M,B          70   Copy contents of register B
1606   INX H            23     to memory location pointed
                               to by HL register pair.
1607   MOV A,H          7C   Increment HL and copy H to
                               accumulator.
1608   CPI 14H          FE   Compare value taken from H
1609   -                14     register with 14H.
160A   JNZ     1605H    C2   If comparison is true we are
160B   -                05     pointing to one location 
                               beyond end so VDU RAM.
160C   -                16   If not we jump back to 1605H
                               and repeat.
160D   LXI D   6000H    11   If VDU screen is filled, load
160E   -                00     DE register pair with
160F   -                60     timing byte value 6000H.
1610   DCX D            1B   Decrement DE register pair by one
1611   MOV A,D          7A   Copy value in D to accumulator.
1612   ORA E            B3   OR it with value currently in
                               E register.
1613   JNZ     1610H    C2   If it is in zero continue
1614   -                10     through program, otherwise
1615   -                16     jump back to 1610H and
                               keep decrementing.
1616   MOV A,B          78   Copy contents of B to accumulator
1617   CPI 20H          FE   Compare with ASCII code for 
1618   -                20     SPACE. 
1619   JNZ     1600H    C2   If it does not compare,
161A   -                00     jump back to beginning of
161B   -                16     program and clear screen.
161C   MVI B   7AH      06   If it does compare, set ASCII
161D   -                7A     code for "WHITE CELL" in 
                               register B
161E   JMP     1602H    C3   Then jump back to 1602H
161F   -                02     and make screen white.
1620   -                16 
</pre>

<p>You will notice that each time a memory mapping operation takes place you see a number of pulses flash up on the TV screen. These represent the moments of time the CPU takes over control of the VDU's addressing lines. They are particularly noticeable in this experiment because we are sequentially addressing nearly 1,000 bytes of VDU memory. In most instances one would not be changing data in so many places in so short a period of time, and the effect of the odd pulse now and again is hardly noticeable.</p>

<h3>MODEM Echo Test Program</h3>

<p>The internal MODEM on the TRITON is primarily for recording programs onto tape, but it can also be used for data transmission. The principles are exactly the same. There is a subroutine in the Monitor called TPT (short for Tape Out) which simply places whatever data is in the accumulator into the transmitter buffer of the UART, which serialises it and modulates the carrier of the MODEM. A bonus exists within TRITON in that the UART/MODEM pair will transmit and receive simultaneously. One can therefore connect the MODEM's output back to its input, and link the TPT routine to its complement TPIN, which takes received data from the UART and places it into the accumulator. By placing these subroutines within a looped program, one can output data from the accumulator through the MODEM, feed it back to the MODEM's input, and then decode it in the UART and place it back into the accumulator. If all goes well the received data should be identical to the transmitted data. If it is not, then you have something wrong with your tape I/O hardware. The following program outputs the ASCII code for A through the MODEM and then clears the accumulator in preparation for the received data. When the latter arrives back it is output to the VDU. You should see a continuously repeated printing of letter "A".</p> 

<pre>
1600   HUI A   41H      3E   Set accumulator to ASCII code
1601   -                41     for "A".
1602   CALL    TPT      CD   Call subroutine which serialises
1603   -                AD     and modulates data from
1604   -                02     accumulator onto tape
                               recorder output line.
1605   SUB A            97   Destroy data in accumulator
                               by clearing it.
1606   CALL    TPIN     CD   Call subroutine which demodulates
1607   -                1D     incoming data and forms it
1608   -                03     into parallel word, finally
                               placing it in accumulator.
1609   CALL    OUTCH    CD   Print contents of accumulator
160A   -                13     on VDU.
160B   -                00
160C   JMP     1600H    C3   Jump back to 1600H and keep
160D   -                00     repeating.
160E   -                16 
</pre>

<p>Before running the program, short the tape out and tape in sockets together on the computer's DIN socket. Run the program, and try adjusting the baud rate control - you should see a noticeable difference in the speed of reception of the letter A. Remove the shorting wire and reception should stop. When you replace it reception should start again. With a slightly more sophisticated program you could arrange for one TRITON to communicate with another down a pair of wires or via a radio link. An even simpler pair of programs would allow you to type directly onto tape and play back what you have typed onto the VDU. Why not try and write these for yourself using the INCH and OUTCH utilities as well as the TPT and TPIN routines shown above. Note that TPT and TPIN are not fixed location routines so you can only call them at addresses 02ADH and 031D respectively when using MONITOR V4.1.</p>

<h3>Test Tape Playback Program</h3>

<p>In the section on how to make the TRITON, we suggested you use Transam Components Ltd's test tape to adjust the baud rate of your UART - the program was listed, and instructions were given on how to use it. By repeating it here with mnemonics and instruction descriptions, we hope that you will be able to follow it through without any further explanation.</p>

<pre>
1600   CALL    TPEON    CD   Call subroutine which switches
1601   -                27     on tape control relay.
1602   -                03
1603   CALL    TPIN     CD   Call subroutine to input data
1604   -                1D     from tape and store in
1605   -                03     accumulator.
1606   CALL    OUTCH    CD   Print contents of accumulator
1607   -                13     on VDU.
1608   -                00
1609   JMP     1603H    C3   Jump back to 1603H for next
160A   -                03     byte from tape recorder.
160B   -                16
</pre>

<p>Note that TPEON can only be called at address 0327H when using MONITOR V4.1.</p>

<h3>Test Tape Record Program </h3>

<p>In case you have lost your test tape, or want to make mother copy to be on the safe side, you can write the program written by Transam to produce our master copy. Your system must have been set up to the correct baud rate prior to making your own test recording, otherwise you will only be calibrating your own system against itself.</p>

<pre>
1600   MVI A   41H      3E   Set ASCII code for "A"
1601   -                41     in accumulator.
1602   CALL    TPT      CD   Call subroutine which outputs
1603   -                AD     contents of accumulator
1604   -                02     to tape.
1605   INR A            3C   Increment ASCII code in
                               accumulator.
1606   CPI     5BH      FE   Compare it against code which
1607   -                5B     is one greater than "Z".
1608   JNZ     1602H    C2   If it is not, jump back to
1609   -                02     1602H and keep repeating.
160A   -                16
160B   MVI A   0DH      3E   If "Z" has been reached and
160C   -                0D     recorded, set accumulator
                               to ASCII for CR.
160D   CALL    TPT      CD   Output carriage return code
160E   -                AD     to tape.
160F   -                02
1610   MVI A   0AH      3E   Set accumulator to ASCII code
1611   -                0A     for line feed.
1612   CALL    TPT      CD   Output line feed code to tape.
1613   -                AD
1614   -                02
1615   JMP     1600H    C3   Jump back to beginning of
1616   -                00     program and keep repeating.
1617   -                16
</pre>

<p>The program repeatedly outputs the alphabet (followed by carriage return and line feed) to tape for as lona as you care to let it run.</p>

<h3>Siren Program</h3>

<p>In the previous program examples we have tried to demonstrate most of the Monitor's utilities and at the same time exercise the more important I/O facilities of TRITON. We have not yet used the spare output port, and this program will demonstrate how you can go about using it to communicate with the outside world (in this case with a crystal earpiece or external amplifier). Port 6 is only a two bit port - outputting any data on the two most significant data bus lines. We shall use bit 8 to generate an audio frequency square wave output, but to make the program a bit more interesting shall use software to make the frequency increase over a period of time.</p>

<pre>
1600   MVI B   80H      06   Set register B to initial
1601   -                80     note divisor value
                               (128 decimal).
1602   MVI C   20H      0E   Set register C to value to
1603   -                20     give note duration. 
1604   MOV D,B          50   Copy current divisor from
                               B into D.
1605   CMA              2F   Complement accumulator.
1606   DCR D            15   Decrement register D by one.
1607   JNZ     1606M    C2   If register D is not zero,
1608   -                06     jump back to 1606H
1609   -                16     and repeat.
160A   OUT     PORT 06H D3   If it is, output value in
160B   -                06     accumulator to port 6.
160C   DCR C            0D   Decrement register C by one.
160D   JNZ     1604H    C2   If it is not zero, jump
160E   -                04   back to 1604H and repeat.
160F   -                16
1610   DCR B            05   If it is, decrement register
                               B by one.
1611   JNZ     1602H    C2   If register B is not zero,
1612   -                02     jump back to 1602H
1613   -                16     and repeat.
1614   JMP     1600H    C3   If it is, jump back to start
1615   -                00     of program and keep 
1616   -                16     repeating.
</pre>

<p>It is the CMA instruction which makes the output signal alternate between "1" and "0". The time taken between transitions is controlled by the value of the D register which, in the first instance, gets its data from register B. Each time a note is played and held for its duration (set by the value in C) register D is decremented so that the next note will have a marginally higher frequency. The program loops until the value in D is zero (infinite frequency!) and then starts all over again.</p>

<p>To keep the program short and simple we have omitted to compensate for the fact that we have one shortening timing loop nested within another. In practice this means that as the note divisor value diminishes so will the duration of the note. For this program you can hardly notice it, but if you use TRITON to synthesise music you must make allowances for this.</p>

<p>With an even simpler program than this you could use TRITON as a high stability square wave generator.</p>

<p>Without doubt you will get most enjoyment from machine code programming when you start to write more lengthy programs than those we have used as illustrations. Space does not permit us to go any further at this stage, but we hope that the examples will get you going on the road to writing your own. Good luck!</p>

</body>
</html>
